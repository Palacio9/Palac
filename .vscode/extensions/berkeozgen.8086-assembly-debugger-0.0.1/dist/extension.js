"use strict";var Xn=Object.create;var lt=Object.defineProperty;var Jn=Object.getOwnPropertyDescriptor;var Qn=Object.getOwnPropertyNames;var Kn=Object.getPrototypeOf,Zn=Object.prototype.hasOwnProperty;var q=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Yn=(s,e)=>{for(var t in e)lt(s,t,{get:e[t],enumerable:!0})},ks=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Qn(e))!Zn.call(s,i)&&i!==t&&lt(s,i,{get:()=>e[i],enumerable:!(r=Jn(e,i))||r.enumerable});return s};var ce=(s,e,t)=>(t=s!=null?Xn(Kn(s)):{},ks(e||!s||!s.__esModule?lt(t,"default",{value:s,enumerable:!0}):t,s)),ei=s=>ks(lt({},"__esModule",{value:!0}),s);var ct=q(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.Event=he.Response=he.Message=void 0;var ut=class{constructor(e){this.seq=0,this.type=e}};he.Message=ut;var Cs=class extends ut{constructor(e,t){super("response");this.request_seq=e.seq,this.command=e.command,t?(this.success=!1,this.message=t):this.success=!0}};he.Response=Cs;var Bs=class extends ut{constructor(e,t){super("event");this.event=e,t&&(this.body=t)}};he.Event=Bs});var Ns=q(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.ProtocolServer=void 0;var ti=require("events"),We=ct(),Ts=class{get event(){return this._event||(this._event=(e,t)=>{this._listener=e,this._this=t;let r;return r={dispose:()=>{this._listener=void 0,this._this=void 0}},r}),this._event}fire(e){if(this._listener)try{this._listener.call(this._this,e)}catch{}}hasListener(){return!!this._listener}dispose(){this._listener=void 0,this._this=void 0}},Ie=class extends ti.EventEmitter{constructor(){super();this._sendMessage=new Ts,this._pendingRequests=new Map,this.onDidSendMessage=this._sendMessage.event}dispose(){}handleMessage(e){if(e.type==="request")this.dispatchRequest(e);else if(e.type==="response"){let t=e,r=this._pendingRequests.get(t.request_seq);r&&(this._pendingRequests.delete(t.request_seq),r(t))}}_isRunningInline(){return this._sendMessage&&this._sendMessage.hasListener()}start(e,t){this._sequence=1,this._writableStream=t,this._rawData=Buffer.alloc(0),e.on("data",r=>this._handleData(r)),e.on("close",()=>{this._emitEvent(new We.Event("close"))}),e.on("error",r=>{this._emitEvent(new We.Event("error","inStream error: "+(r&&r.message)))}),t.on("error",r=>{this._emitEvent(new We.Event("error","outStream error: "+(r&&r.message)))}),e.resume()}stop(){this._writableStream&&this._writableStream.end()}sendEvent(e){this._send("event",e)}sendResponse(e){e.seq>0?console.error(`attempt to send more than one response for command ${e.command}`):this._send("response",e)}sendRequest(e,t,r,i){let o={command:e};if(t&&Object.keys(t).length>0&&(o.arguments=t),this._send("request",o),i){this._pendingRequests.set(o.seq,i);let a=setTimeout(()=>{clearTimeout(a);let u=this._pendingRequests.get(o.seq);u&&(this._pendingRequests.delete(o.seq),u(new We.Response(o,"timeout")))},r)}}dispatchRequest(e){}_emitEvent(e){this.emit(e.event,e)}_send(e,t){if(t.type=e,t.seq=this._sequence++,this._writableStream){let r=JSON.stringify(t);this._writableStream.write(`Content-Length: ${Buffer.byteLength(r,"utf8")}\r
\r
${r}`,"utf8")}this._sendMessage.fire(t)}_handleData(e){for(this._rawData=Buffer.concat([this._rawData,e]);;){if(this._contentLength>=0){if(this._rawData.length>=this._contentLength){let t=this._rawData.toString("utf8",0,this._contentLength);if(this._rawData=this._rawData.slice(this._contentLength),this._contentLength=-1,t.length>0)try{let r=JSON.parse(t);this.handleMessage(r)}catch(r){this._emitEvent(new We.Event("error","Error handling data: "+(r&&r.message)))}continue}}else{let t=this._rawData.indexOf(Ie.TWO_CRLF);if(t!==-1){let i=this._rawData.toString("utf8",0,t).split(`\r
`);for(let o=0;o<i.length;o++){let a=i[o].split(/: +/);a[0]=="Content-Length"&&(this._contentLength=+a[1])}this._rawData=this._rawData.slice(t+Ie.TWO_CRLF.length);continue}}break}}};dt.ProtocolServer=Ie;Ie.TWO_CRLF=`\r
\r
`});var _s=q(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.runDebugAdapter=void 0;var si=require("net");function ri(s){let e=0;if(process.argv.slice(2).forEach(function(r,i,o){let a=/^--server=(\d{4,5})$/.exec(r);a&&(e=parseInt(a[1],10))}),e>0)console.error(`waiting for debug protocol on port ${e}`),si.createServer(r=>{console.error(">> accepted connection from client"),r.on("end",()=>{console.error(`>> client connection closed
`)});let i=new s(!1,!0);i.setRunAsServer(!0),i.start(r,r)}).listen(e);else{let r=new s(!1);process.on("SIGTERM",()=>{r.shutdown()}),r.start(process.stdin,process.stdout)}}pt.runDebugAdapter=ri});var ht=q(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.DebugSession=m.ErrorDestination=m.MemoryEvent=m.InvalidatedEvent=m.ProgressEndEvent=m.ProgressUpdateEvent=m.ProgressStartEvent=m.CapabilitiesEvent=m.LoadedSourceEvent=m.ModuleEvent=m.BreakpointEvent=m.ThreadEvent=m.OutputEvent=m.ExitedEvent=m.TerminatedEvent=m.InitializedEvent=m.ContinuedEvent=m.StoppedEvent=m.CompletionItem=m.Module=m.Breakpoint=m.Variable=m.Thread=m.StackFrame=m.Scope=m.Source=void 0;var ni=Ns(),T=ct(),ii=_s(),Os=require("url"),Fs=class{constructor(e,t,r=0,i,o){this.name=e,this.path=t,this.sourceReference=r,i&&(this.origin=i),o&&(this.adapterData=o)}};m.Source=Fs;var Us=class{constructor(e,t,r=!1){this.name=e,this.variablesReference=t,this.expensive=r}};m.Scope=Us;var Ms=class{constructor(e,t,r,i=0,o=0){this.id=e,this.source=r,this.line=i,this.column=o,this.name=t}};m.StackFrame=Ms;var zs=class{constructor(e,t){this.id=e,t?this.name=t:this.name="Thread #"+e}};m.Thread=zs;var Ws=class{constructor(e,t,r=0,i,o){this.name=e,this.value=t,this.variablesReference=r,typeof o=="number"&&(this.namedVariables=o),typeof i=="number"&&(this.indexedVariables=i)}};m.Variable=Ws;var Gs=class{constructor(e,t,r,i){this.verified=e;let o=this;typeof t=="number"&&(o.line=t),typeof r=="number"&&(o.column=r),i&&(o.source=i)}setId(e){this.id=e}};m.Breakpoint=Gs;var Vs=class{constructor(e,t){this.id=e,this.name=t}};m.Module=Vs;var qs=class{constructor(e,t,r=0){this.label=e,this.start=t,this.length=r}};m.CompletionItem=qs;var js=class extends T.Event{constructor(e,t,r){super("stopped");this.body={reason:e},typeof t=="number"&&(this.body.threadId=t),typeof r=="string"&&(this.body.text=r)}};m.StoppedEvent=js;var Hs=class extends T.Event{constructor(e,t){super("continued");this.body={threadId:e},typeof t=="boolean"&&(this.body.allThreadsContinued=t)}};m.ContinuedEvent=Hs;var $s=class extends T.Event{constructor(){super("initialized")}};m.InitializedEvent=$s;var Xs=class extends T.Event{constructor(e){super("terminated");if(typeof e=="boolean"||e){let t=this;t.body={restart:e}}}};m.TerminatedEvent=Xs;var Js=class extends T.Event{constructor(e){super("exited");this.body={exitCode:e}}};m.ExitedEvent=Js;var Qs=class extends T.Event{constructor(e,t="console",r){super("output");this.body={category:t,output:e},r!==void 0&&(this.body.data=r)}};m.OutputEvent=Qs;var Ks=class extends T.Event{constructor(e,t){super("thread");this.body={reason:e,threadId:t}}};m.ThreadEvent=Ks;var Zs=class extends T.Event{constructor(e,t){super("breakpoint");this.body={reason:e,breakpoint:t}}};m.BreakpointEvent=Zs;var Ys=class extends T.Event{constructor(e,t){super("module");this.body={reason:e,module:t}}};m.ModuleEvent=Ys;var er=class extends T.Event{constructor(e,t){super("loadedSource");this.body={reason:e,source:t}}};m.LoadedSourceEvent=er;var tr=class extends T.Event{constructor(e){super("capabilities");this.body={capabilities:e}}};m.CapabilitiesEvent=tr;var sr=class extends T.Event{constructor(e,t,r){super("progressStart");this.body={progressId:e,title:t},typeof r=="string"&&(this.body.message=r)}};m.ProgressStartEvent=sr;var rr=class extends T.Event{constructor(e,t){super("progressUpdate");this.body={progressId:e},typeof t=="string"&&(this.body.message=t)}};m.ProgressUpdateEvent=rr;var nr=class extends T.Event{constructor(e,t){super("progressEnd");this.body={progressId:e},typeof t=="string"&&(this.body.message=t)}};m.ProgressEndEvent=nr;var ir=class extends T.Event{constructor(e,t,r){super("invalidated");this.body={},e&&(this.body.areas=e),t&&(this.body.threadId=t),r&&(this.body.stackFrameId=r)}};m.InvalidatedEvent=ir;var or=class extends T.Event{constructor(e,t,r){super("memory");this.body={memoryReference:e,offset:t,count:r}}};m.MemoryEvent=or;var Ae;(function(s){s[s.User=1]="User",s[s.Telemetry=2]="Telemetry"})(Ae=m.ErrorDestination||(m.ErrorDestination={}));var ne=class extends ni.ProtocolServer{constructor(e,t){super();let r=typeof e=="boolean"?e:!1;this._debuggerLinesStartAt1=r,this._debuggerColumnsStartAt1=r,this._debuggerPathsAreURIs=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0,this._clientPathsAreURIs=!1,this._isServer=typeof t=="boolean"?t:!1,this.on("close",()=>{this.shutdown()}),this.on("error",i=>{this.shutdown()})}setDebuggerPathFormat(e){this._debuggerPathsAreURIs=e!=="path"}setDebuggerLinesStartAt1(e){this._debuggerLinesStartAt1=e}setDebuggerColumnsStartAt1(e){this._debuggerColumnsStartAt1=e}setRunAsServer(e){this._isServer=e}static run(e){(0,ii.runDebugAdapter)(e)}shutdown(){this._isServer||this._isRunningInline()||setTimeout(()=>{process.exit(0)},100)}sendErrorResponse(e,t,r,i,o=Ae.User){let a;typeof t=="number"?(a={id:t,format:r},i&&(a.variables=i),o&Ae.User&&(a.showUser=!0),o&Ae.Telemetry&&(a.sendTelemetry=!0)):a=t,e.success=!1,e.message=ne.formatPII(a.format,!0,a.variables),e.body||(e.body={}),e.body.error=a,this.sendResponse(e)}runInTerminalRequest(e,t,r){this.sendRequest("runInTerminal",e,t,r)}dispatchRequest(e){let t=new T.Response(e);try{if(e.command==="initialize"){var r=e.arguments;if(typeof r.linesStartAt1=="boolean"&&(this._clientLinesStartAt1=r.linesStartAt1),typeof r.columnsStartAt1=="boolean"&&(this._clientColumnsStartAt1=r.columnsStartAt1),r.pathFormat!=="path")this.sendErrorResponse(t,2018,"debug adapter only supports native paths",null,Ae.Telemetry);else{let i=t;i.body={},this.initializeRequest(i,r)}}else e.command==="launch"?this.launchRequest(t,e.arguments,e):e.command==="attach"?this.attachRequest(t,e.arguments,e):e.command==="disconnect"?this.disconnectRequest(t,e.arguments,e):e.command==="terminate"?this.terminateRequest(t,e.arguments,e):e.command==="restart"?this.restartRequest(t,e.arguments,e):e.command==="setBreakpoints"?this.setBreakPointsRequest(t,e.arguments,e):e.command==="setFunctionBreakpoints"?this.setFunctionBreakPointsRequest(t,e.arguments,e):e.command==="setExceptionBreakpoints"?this.setExceptionBreakPointsRequest(t,e.arguments,e):e.command==="configurationDone"?this.configurationDoneRequest(t,e.arguments,e):e.command==="continue"?this.continueRequest(t,e.arguments,e):e.command==="next"?this.nextRequest(t,e.arguments,e):e.command==="stepIn"?this.stepInRequest(t,e.arguments,e):e.command==="stepOut"?this.stepOutRequest(t,e.arguments,e):e.command==="stepBack"?this.stepBackRequest(t,e.arguments,e):e.command==="reverseContinue"?this.reverseContinueRequest(t,e.arguments,e):e.command==="restartFrame"?this.restartFrameRequest(t,e.arguments,e):e.command==="goto"?this.gotoRequest(t,e.arguments,e):e.command==="pause"?this.pauseRequest(t,e.arguments,e):e.command==="stackTrace"?this.stackTraceRequest(t,e.arguments,e):e.command==="scopes"?this.scopesRequest(t,e.arguments,e):e.command==="variables"?this.variablesRequest(t,e.arguments,e):e.command==="setVariable"?this.setVariableRequest(t,e.arguments,e):e.command==="setExpression"?this.setExpressionRequest(t,e.arguments,e):e.command==="source"?this.sourceRequest(t,e.arguments,e):e.command==="threads"?this.threadsRequest(t,e):e.command==="terminateThreads"?this.terminateThreadsRequest(t,e.arguments,e):e.command==="evaluate"?this.evaluateRequest(t,e.arguments,e):e.command==="stepInTargets"?this.stepInTargetsRequest(t,e.arguments,e):e.command==="gotoTargets"?this.gotoTargetsRequest(t,e.arguments,e):e.command==="completions"?this.completionsRequest(t,e.arguments,e):e.command==="exceptionInfo"?this.exceptionInfoRequest(t,e.arguments,e):e.command==="loadedSources"?this.loadedSourcesRequest(t,e.arguments,e):e.command==="dataBreakpointInfo"?this.dataBreakpointInfoRequest(t,e.arguments,e):e.command==="setDataBreakpoints"?this.setDataBreakpointsRequest(t,e.arguments,e):e.command==="readMemory"?this.readMemoryRequest(t,e.arguments,e):e.command==="writeMemory"?this.writeMemoryRequest(t,e.arguments,e):e.command==="disassemble"?this.disassembleRequest(t,e.arguments,e):e.command==="cancel"?this.cancelRequest(t,e.arguments,e):e.command==="breakpointLocations"?this.breakpointLocationsRequest(t,e.arguments,e):e.command==="setInstructionBreakpoints"?this.setInstructionBreakpointsRequest(t,e.arguments,e):this.customRequest(e.command,t,e.arguments,e)}catch(i){this.sendErrorResponse(t,1104,"{_stack}",{_exception:i.message,_stack:i.stack},Ae.Telemetry)}}initializeRequest(e,t){e.body.supportsConditionalBreakpoints=!1,e.body.supportsHitConditionalBreakpoints=!1,e.body.supportsFunctionBreakpoints=!1,e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!1,e.body.supportsStepBack=!1,e.body.supportsSetVariable=!1,e.body.supportsRestartFrame=!1,e.body.supportsStepInTargetsRequest=!1,e.body.supportsGotoTargetsRequest=!1,e.body.supportsCompletionsRequest=!1,e.body.supportsRestartRequest=!1,e.body.supportsExceptionOptions=!1,e.body.supportsValueFormattingOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportTerminateDebuggee=!1,e.body.supportsDelayedStackTraceLoading=!1,e.body.supportsLoadedSourcesRequest=!1,e.body.supportsLogPoints=!1,e.body.supportsTerminateThreadsRequest=!1,e.body.supportsSetExpression=!1,e.body.supportsTerminateRequest=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsReadMemoryRequest=!1,e.body.supportsDisassembleRequest=!1,e.body.supportsCancelRequest=!1,e.body.supportsBreakpointLocationsRequest=!1,e.body.supportsClipboardContext=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsExceptionFilterOptions=!1,this.sendResponse(e)}disconnectRequest(e,t,r){this.sendResponse(e),this.shutdown()}launchRequest(e,t,r){this.sendResponse(e)}attachRequest(e,t,r){this.sendResponse(e)}terminateRequest(e,t,r){this.sendResponse(e)}restartRequest(e,t,r){this.sendResponse(e)}setBreakPointsRequest(e,t,r){this.sendResponse(e)}setFunctionBreakPointsRequest(e,t,r){this.sendResponse(e)}setExceptionBreakPointsRequest(e,t,r){this.sendResponse(e)}configurationDoneRequest(e,t,r){this.sendResponse(e)}continueRequest(e,t,r){this.sendResponse(e)}nextRequest(e,t,r){this.sendResponse(e)}stepInRequest(e,t,r){this.sendResponse(e)}stepOutRequest(e,t,r){this.sendResponse(e)}stepBackRequest(e,t,r){this.sendResponse(e)}reverseContinueRequest(e,t,r){this.sendResponse(e)}restartFrameRequest(e,t,r){this.sendResponse(e)}gotoRequest(e,t,r){this.sendResponse(e)}pauseRequest(e,t,r){this.sendResponse(e)}sourceRequest(e,t,r){this.sendResponse(e)}threadsRequest(e,t){this.sendResponse(e)}terminateThreadsRequest(e,t,r){this.sendResponse(e)}stackTraceRequest(e,t,r){this.sendResponse(e)}scopesRequest(e,t,r){this.sendResponse(e)}variablesRequest(e,t,r){this.sendResponse(e)}setVariableRequest(e,t,r){this.sendResponse(e)}setExpressionRequest(e,t,r){this.sendResponse(e)}evaluateRequest(e,t,r){this.sendResponse(e)}stepInTargetsRequest(e,t,r){this.sendResponse(e)}gotoTargetsRequest(e,t,r){this.sendResponse(e)}completionsRequest(e,t,r){this.sendResponse(e)}exceptionInfoRequest(e,t,r){this.sendResponse(e)}loadedSourcesRequest(e,t,r){this.sendResponse(e)}dataBreakpointInfoRequest(e,t,r){this.sendResponse(e)}setDataBreakpointsRequest(e,t,r){this.sendResponse(e)}readMemoryRequest(e,t,r){this.sendResponse(e)}writeMemoryRequest(e,t,r){this.sendResponse(e)}disassembleRequest(e,t,r){this.sendResponse(e)}cancelRequest(e,t,r){this.sendResponse(e)}breakpointLocationsRequest(e,t,r){this.sendResponse(e)}setInstructionBreakpointsRequest(e,t,r){this.sendResponse(e)}customRequest(e,t,r,i){this.sendErrorResponse(t,1014,"unrecognized request",null,Ae.Telemetry)}convertClientLineToDebugger(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e+1:this._clientLinesStartAt1?e-1:e}convertDebuggerLineToClient(e){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?e:e-1:this._clientLinesStartAt1?e+1:e}convertClientColumnToDebugger(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e+1:this._clientColumnsStartAt1?e-1:e}convertDebuggerColumnToClient(e){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?e:e-1:this._clientColumnsStartAt1?e+1:e}convertClientPathToDebugger(e){return this._clientPathsAreURIs!==this._debuggerPathsAreURIs?this._clientPathsAreURIs?ne.uri2path(e):ne.path2uri(e):e}convertDebuggerPathToClient(e){return this._debuggerPathsAreURIs!==this._clientPathsAreURIs?this._debuggerPathsAreURIs?ne.uri2path(e):ne.path2uri(e):e}static path2uri(e){process.platform==="win32"&&(/^[A-Z]:/.test(e)&&(e=e[0].toLowerCase()+e.substr(1)),e=e.replace(/\\/g,"/")),e=encodeURI(e);let t=new Os.URL("file:");return t.pathname=e,t.toString()}static uri2path(e){let t=new Os.URL(e),r=decodeURIComponent(t.pathname);return process.platform==="win32"&&(/^\/[a-zA-Z]:/.test(r)&&(r=r[1].toLowerCase()+r.substr(2)),r=r.replace(/\//g,"\\")),r}static formatPII(e,t,r){return e.replace(ne._formatPIIRegexp,function(i,o){return t&&o.length>0&&o[0]!=="_"?i:r[o]&&r.hasOwnProperty(o)?r[o]:i})}};m.DebugSession=ne;ne._formatPIIRegexp=/{([^}]+)}/g});var dr=q(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.InternalLogger=void 0;var ar=require("fs"),lr=require("path"),j=ft(),cr=class{constructor(e,t){this.beforeExitCallback=()=>this.dispose(),this._logCallback=e,this._logToConsole=t,this._minLogLevel=j.LogLevel.Warn,this.disposeCallback=(r,i)=>{this.dispose(),i=i||2,i+=128,process.exit(i)}}async setup(e){if(this._minLogLevel=e.consoleMinLogLevel,this._prependTimestamp=e.prependTimestamp,e.logFilePath)if(!lr.isAbsolute(e.logFilePath))this.log(`logFilePath must be an absolute path: ${e.logFilePath}`,j.LogLevel.Error);else{let t=r=>this.sendLog(`Error creating log file at path: ${e.logFilePath}. Error: ${r.toString()}
`,j.LogLevel.Error);try{await ar.promises.mkdir(lr.dirname(e.logFilePath),{recursive:!0}),this.log(`Verbose logs are written to:
`,j.LogLevel.Warn),this.log(e.logFilePath+`
`,j.LogLevel.Warn),this._logFileStream=ar.createWriteStream(e.logFilePath),this.logDateTime(),this.setupShutdownListeners(),this._logFileStream.on("error",r=>{t(r)})}catch(r){t(r)}}}logDateTime(){let e=new Date,r=e.getUTCFullYear()+`-${e.getUTCMonth()+1}-`+e.getUTCDate()+", "+ur();this.log(r+`
`,j.LogLevel.Verbose,!1)}setupShutdownListeners(){process.on("beforeExit",this.beforeExitCallback),process.on("SIGTERM",this.disposeCallback),process.on("SIGINT",this.disposeCallback)}removeShutdownListeners(){process.removeListener("beforeExit",this.beforeExitCallback),process.removeListener("SIGTERM",this.disposeCallback),process.removeListener("SIGINT",this.disposeCallback)}dispose(){return new Promise(e=>{this.removeShutdownListeners(),this._logFileStream?(this._logFileStream.end(e),this._logFileStream=null):e()})}log(e,t,r=!0){if(this._minLogLevel!==j.LogLevel.Stop){if(t>=this._minLogLevel&&this.sendLog(e,t),this._logToConsole){let i=t===j.LogLevel.Error?console.error:t===j.LogLevel.Warn?console.warn:null;i&&i((0,j.trimLastNewline)(e))}t===j.LogLevel.Error&&(e=`[${j.LogLevel[t]}] ${e}`),this._prependTimestamp&&r&&(e="["+ur()+"] "+e),this._logFileStream&&this._logFileStream.write(e)}}sendLog(e,t){if(e.length>1500){let r=!!e.match(/(\n|\r\n)$/);e=e.substr(0,1500)+"[...]",r&&(e=e+`
`)}if(this._logCallback){let r=new j.LogOutputEvent(e,t);this._logCallback(r)}}};mt.InternalLogger=cr;function ur(){let s=new Date,e=gt(2,String(s.getUTCHours())),t=gt(2,String(s.getUTCMinutes())),r=gt(2,String(s.getUTCSeconds())),i=gt(3,String(s.getUTCMilliseconds()));return e+":"+t+":"+r+"."+i+" UTC"}function gt(s,e){return e.length>=s?e:String("0".repeat(s)+e).slice(-s)}});var ft=q(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.trimLastNewline=H.LogOutputEvent=H.logger=H.Logger=H.LogLevel=void 0;var oi=dr(),ai=ht(),ge;(function(s){s[s.Verbose=0]="Verbose",s[s.Log=1]="Log",s[s.Warn=2]="Warn",s[s.Error=3]="Error",s[s.Stop=4]="Stop"})(ge=H.LogLevel||(H.LogLevel={}));var jt=class{constructor(){this._pendingLogQ=[]}log(e,t=ge.Log){e=e+`
`,this._write(e,t)}verbose(e){this.log(e,ge.Verbose)}warn(e){this.log(e,ge.Warn)}error(e){this.log(e,ge.Error)}dispose(){if(this._currentLogger){let e=this._currentLogger.dispose();return this._currentLogger=null,e}else return Promise.resolve()}_write(e,t=ge.Log){e=e+"",this._pendingLogQ?this._pendingLogQ.push({msg:e,level:t}):this._currentLogger&&this._currentLogger.log(e,t)}setup(e,t,r=!0){let i=typeof t=="string"?t:t&&this._logFilePathFromInit;if(this._currentLogger){let o={consoleMinLogLevel:e,logFilePath:i,prependTimestamp:r};this._currentLogger.setup(o).then(()=>{if(this._pendingLogQ){let a=this._pendingLogQ;this._pendingLogQ=null,a.forEach(u=>this._write(u.msg,u.level))}})}}init(e,t,r){this._pendingLogQ=this._pendingLogQ||[],this._currentLogger=new oi.InternalLogger(e,r),this._logFilePathFromInit=t}};H.Logger=jt;H.logger=new jt;var pr=class extends ai.OutputEvent{constructor(e,t){let r=t===ge.Error?"stderr":t===ge.Warn?"console":"stdout";super(e,r)}};H.LogOutputEvent=pr;function li(s){return s.replace(/(\n|\r\n)$/,"")}H.trimLastNewline=li});var fr=q(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.LoggingDebugSession=void 0;var gr=ft(),Pe=gr.logger,hr=ht(),mr=class extends hr.DebugSession{constructor(e,t,r){super(t,r);this.obsolete_logFilePath=e,this.on("error",i=>{Pe.error(i.body)})}start(e,t){super.start(e,t),Pe.init(r=>this.sendEvent(r),this.obsolete_logFilePath,this._isServer)}sendEvent(e){if(!(e instanceof gr.LogOutputEvent)){let t=e;e instanceof hr.OutputEvent&&e.body&&e.body.data&&e.body.data.doNotLogOutput&&(delete e.body.data.doNotLogOutput,t={...e},t.body={...e.body,output:"<output not logged>"}),Pe.verbose(`To client: ${JSON.stringify(t)}`)}super.sendEvent(e)}sendRequest(e,t,r,i){Pe.verbose(`To client: ${JSON.stringify(e)}(${JSON.stringify(t)}), timeout: ${r}`),super.sendRequest(e,t,r,i)}sendResponse(e){Pe.verbose(`To client: ${JSON.stringify(e)}`),super.sendResponse(e)}dispatchRequest(e){Pe.verbose(`From client: ${e.command}(${JSON.stringify(e.arguments)})`),super.dispatchRequest(e)}};bt.LoggingDebugSession=mr});var vr=q(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.Handles=void 0;var br=class{constructor(e){this.START_HANDLE=1e3,this._handleMap=new Map,this._nextHandle=typeof e=="number"?e:this.START_HANDLE}reset(){this._nextHandle=this.START_HANDLE,this._handleMap=new Map}create(e){var t=this._nextHandle++;return this._handleMap.set(t,e),t}get(e,t){return this._handleMap.get(e)||t}};vt.Handles=br});var Rr=q(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.Handles=h.Response=h.Event=h.ErrorDestination=h.CompletionItem=h.Module=h.Source=h.Breakpoint=h.Variable=h.Scope=h.StackFrame=h.Thread=h.MemoryEvent=h.InvalidatedEvent=h.ProgressEndEvent=h.ProgressUpdateEvent=h.ProgressStartEvent=h.CapabilitiesEvent=h.LoadedSourceEvent=h.ModuleEvent=h.BreakpointEvent=h.ThreadEvent=h.OutputEvent=h.ContinuedEvent=h.StoppedEvent=h.ExitedEvent=h.TerminatedEvent=h.InitializedEvent=h.logger=h.Logger=h.LoggingDebugSession=h.DebugSession=void 0;var R=ht();Object.defineProperty(h,"DebugSession",{enumerable:!0,get:function(){return R.DebugSession}});Object.defineProperty(h,"InitializedEvent",{enumerable:!0,get:function(){return R.InitializedEvent}});Object.defineProperty(h,"TerminatedEvent",{enumerable:!0,get:function(){return R.TerminatedEvent}});Object.defineProperty(h,"ExitedEvent",{enumerable:!0,get:function(){return R.ExitedEvent}});Object.defineProperty(h,"StoppedEvent",{enumerable:!0,get:function(){return R.StoppedEvent}});Object.defineProperty(h,"ContinuedEvent",{enumerable:!0,get:function(){return R.ContinuedEvent}});Object.defineProperty(h,"OutputEvent",{enumerable:!0,get:function(){return R.OutputEvent}});Object.defineProperty(h,"ThreadEvent",{enumerable:!0,get:function(){return R.ThreadEvent}});Object.defineProperty(h,"BreakpointEvent",{enumerable:!0,get:function(){return R.BreakpointEvent}});Object.defineProperty(h,"ModuleEvent",{enumerable:!0,get:function(){return R.ModuleEvent}});Object.defineProperty(h,"LoadedSourceEvent",{enumerable:!0,get:function(){return R.LoadedSourceEvent}});Object.defineProperty(h,"CapabilitiesEvent",{enumerable:!0,get:function(){return R.CapabilitiesEvent}});Object.defineProperty(h,"ProgressStartEvent",{enumerable:!0,get:function(){return R.ProgressStartEvent}});Object.defineProperty(h,"ProgressUpdateEvent",{enumerable:!0,get:function(){return R.ProgressUpdateEvent}});Object.defineProperty(h,"ProgressEndEvent",{enumerable:!0,get:function(){return R.ProgressEndEvent}});Object.defineProperty(h,"InvalidatedEvent",{enumerable:!0,get:function(){return R.InvalidatedEvent}});Object.defineProperty(h,"MemoryEvent",{enumerable:!0,get:function(){return R.MemoryEvent}});Object.defineProperty(h,"Thread",{enumerable:!0,get:function(){return R.Thread}});Object.defineProperty(h,"StackFrame",{enumerable:!0,get:function(){return R.StackFrame}});Object.defineProperty(h,"Scope",{enumerable:!0,get:function(){return R.Scope}});Object.defineProperty(h,"Variable",{enumerable:!0,get:function(){return R.Variable}});Object.defineProperty(h,"Breakpoint",{enumerable:!0,get:function(){return R.Breakpoint}});Object.defineProperty(h,"Source",{enumerable:!0,get:function(){return R.Source}});Object.defineProperty(h,"Module",{enumerable:!0,get:function(){return R.Module}});Object.defineProperty(h,"CompletionItem",{enumerable:!0,get:function(){return R.CompletionItem}});Object.defineProperty(h,"ErrorDestination",{enumerable:!0,get:function(){return R.ErrorDestination}});var ui=fr();Object.defineProperty(h,"LoggingDebugSession",{enumerable:!0,get:function(){return ui.LoggingDebugSession}});var Dr=ft();h.Logger=Dr;var yr=ct();Object.defineProperty(h,"Event",{enumerable:!0,get:function(){return yr.Event}});Object.defineProperty(h,"Response",{enumerable:!0,get:function(){return yr.Response}});var ci=vr();Object.defineProperty(h,"Handles",{enumerable:!0,get:function(){return ci.Handles}});var di=Dr.logger;h.logger=di});var xr=q((Oi,wr)=>{"use strict";function ie(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function Ar(s,e){for(var t="",r=0,i=-1,o=0,a,u=0;u<=s.length;++u){if(u<s.length)a=s.charCodeAt(u);else{if(a===47)break;a=47}if(a===47){if(!(i===u-1||o===1))if(i!==u-1&&o===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var c=t.lastIndexOf("/");if(c!==t.length-1){c===-1?(t="",r=0):(t=t.slice(0,c),r=t.length-1-t.lastIndexOf("/")),i=u,o=0;continue}}else if(t.length===2||t.length===1){t="",r=0,i=u,o=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+s.slice(i+1,u):t=s.slice(i+1,u),r=u-i-1;i=u,o=0}else a===46&&o!==-1?++o:o=-1}return t}function pi(s,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+s+r:r}var Le={resolve:function(){for(var e="",t=!1,r,i=arguments.length-1;i>=-1&&!t;i--){var o;i>=0?o=arguments[i]:(r===void 0&&(r=process.cwd()),o=r),ie(o),o.length!==0&&(e=o+"/"+e,t=o.charCodeAt(0)===47)}return e=Ar(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(ie(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=Ar(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return ie(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];ie(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Le.normalize(e)},relative:function(e,t){if(ie(e),ie(t),e===t||(e=Le.resolve(e),t=Le.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var i=e.length,o=i-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var u=t.length,c=u-a,p=o<c?o:c,g=-1,f=0;f<=p;++f){if(f===p){if(c>p){if(t.charCodeAt(a+f)===47)return t.slice(a+f+1);if(f===0)return t.slice(a+f)}else o>p&&(e.charCodeAt(r+f)===47?g=f:f===0&&(g=0));break}var b=e.charCodeAt(r+f),S=t.charCodeAt(a+f);if(b!==S)break;b===47&&(g=f)}var L="";for(f=r+g+1;f<=i;++f)(f===i||e.charCodeAt(f)===47)&&(L.length===0?L+="..":L+="/..");return L.length>0?L+t.slice(a+g):(a+=g,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(ie(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,i=-1,o=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!o){i=a;break}}else o=!1;return i===-1?r?"/":".":r&&i===1?"//":e.slice(0,i)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');ie(e);var r=0,i=-1,o=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var u=t.length-1,c=-1;for(a=e.length-1;a>=0;--a){var p=e.charCodeAt(a);if(p===47){if(!o){r=a+1;break}}else c===-1&&(o=!1,c=a+1),u>=0&&(p===t.charCodeAt(u)?--u===-1&&(i=a):(u=-1,i=c))}return r===i?i=c:i===-1&&(i=e.length),e.slice(r,i)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!o){r=a+1;break}}else i===-1&&(o=!1,i=a+1);return i===-1?"":e.slice(r,i)}},extname:function(e){ie(e);for(var t=-1,r=0,i=-1,o=!0,a=0,u=e.length-1;u>=0;--u){var c=e.charCodeAt(u);if(c===47){if(!o){r=u+1;break}continue}i===-1&&(o=!1,i=u+1),c===46?t===-1?t=u:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||i===-1||a===0||a===1&&t===i-1&&t===r+1?"":e.slice(t,i)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return pi("/",e)},parse:function(e){ie(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),i=r===47,o;i?(t.root="/",o=1):o=0;for(var a=-1,u=0,c=-1,p=!0,g=e.length-1,f=0;g>=o;--g){if(r=e.charCodeAt(g),r===47){if(!p){u=g+1;break}continue}c===-1&&(p=!1,c=g+1),r===46?a===-1?a=g:f!==1&&(f=1):a!==-1&&(f=-1)}return a===-1||c===-1||f===0||f===1&&a===c-1&&a===u+1?c!==-1&&(u===0&&i?t.base=t.name=e.slice(1,c):t.base=t.name=e.slice(u,c)):(u===0&&i?(t.name=e.slice(1,a),t.base=e.slice(1,c)):(t.name=e.slice(u,a),t.base=e.slice(u,c)),t.ext=e.slice(a,c)),u>0?t.dir=e.slice(0,u-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Le.posix=Le;wr.exports=Le});var xn=q(Ot=>{"use strict";(function(s){var e=function(o,a){return new t(o,a).toString()},t=function(o,a){let u=this,c=8;switch(typeof Buffer<"u"&&(o=Buffer.isBuffer(o)&&o||typeof o=="string"&&Buffer.from(o)||o&&o.constructor===Array&&Buffer.from(o)||Buffer.alloc(0)),o=o||[],a=a||{},u.buffer=o,u.bytes_per_line=parseInt(a.width)||16,u.numbering=a.numbering=="none"?"none":"hex_bytes",u.bytes_per_group=2,a.format){case"none":u.bytes_per_group=0;break;case"twos":u.bytes_per_group=1;break;case"eights":u.bytes_per_group=4;break;case"sixteens":u.bytes_per_group=8;break}switch(u.littleEndian=a.littleEndian||!1,u.radix=a.radix||16,u.caps=a.caps=="upper"?"upper":"lower",u.annotate=a.annotate=="none"?"none":"ascii",u.prefix=a.prefix||"",u.indent=a.indent||0,u.html=a.html||!1,u.offset=a.offset||0,u.length=a.length||-1,u.extendedChs=a.extendedChs||!1,u.display_offset=a.display_offset||0,u.offset&&u.offset<u.buffer.length&&(u.buffer=u.buffer.slice(u.offset)),u.length!==-1&&u.length<=u.buffer.length&&(u.buffer=u.buffer.slice(0,u.length)),u.prefix=(u.html?"&nbsp;":" ").repeat(u.indent)+u.prefix,u.hex_line_length=r(u.bytes_per_group,u.radix)*u.bytes_per_line/Math.max(u.bytes_per_group,1),u.bytes_per_group){case 8:case 4:case 2:u.hex_line_length+=Math.floor(u.bytes_per_line/u.bytes_per_group);break;case 1:u.hex_line_length+=u.bytes_per_line+3;break;case 0:u.hex_line_length+=2;break}u.bytes_per_group=Math.min(u.bytes_per_group,u.bytes_per_line),this.toString=function(){var d="",M=u.offset+u.display_offset,I=!1;u.html&&(d+=`<div class='hexy'>
`);for(var re=0;re<u.buffer.length;re+=u.bytes_per_line){let Y=Math.min(re+u.bytes_per_line,u.buffer.length),Re=u.buffer.slice(re,Y);if(u.html&&(d+="<div class='"+g(M,c,16)+(I?"  odd":" even")+"'>",I=!I),d+=u.prefix,u.numbering==="hex_bytes"&&(d+=g(M,c,16)+": "),d+=p(Re,u.bytes_per_line,u.bytes_per_group,u.radix,u.littleEndian),u.annotate==="ascii"){var ue="";switch(Re.constructor){case Array:ue=String.fromCharCode.apply(u,Re);break;case Uint8Array:Re.forEach(Ue=>ue+=String.fromCharCode(Ue));break;default:ue=Re.toString("latin1")}d+=" "+(u.html?A(ue):L(ue))}d+=u.html?`</div>
`:`
`,M+=u.bytes_per_line}return u.html&&(d+=`</div>
`),d};var p=function(d,M,I,re,ue){var Y="";let Re=I==0?"":" ",Ue=r(I,re),qn=(M-d.length)*(I==0?Ue:(Ue+1)/I);I==0&&(I=1);let jn=ue?I-1:0,Hn=ue?-1:I,$n=ue?-1:1;for(var Vt=0;Vt<d.length/I;++Vt){for(var Me=I<4?0:BigInt(0),qt=jn;qt!=Hn;qt+=$n){let ze=Vt*I+qt;if(ze>=d.length)break;I<4?Me=Me*256+((d.constructor==String?d.codePointAt(ze):d[ze])&255):Me=BigInt(Me)*256n+BigInt((d.constructor==String?d.codePointAt(ze):d[ze])&255)}let Ls=Me.toString(re);for(var Ps=0;Ps<Ue-Ls.length;Ps++)Y+="0";Y+=Ls,Y+=Re,u.caps==="upper"&&(Y=Y.toUpperCase())}return d.length<M&&(Y+=(u.html?"&nbsp;":" ").repeat(qn)),Y=f(Y,u.hex_line_length),Y},g=function(d,M,I){let re=d.toString(I);return"0".repeat(M-re.length)+re},f=function(d,M){let I=M-d.length-1;return I>0&&(d+=(u.html?"&nbsp;":" ").repeat(I)),d};let b=/[^\x20-\x7f]/g,S=/[\x00-\x1f]/g;var L=function(d){return d.replace(u.extendedChs?S:b,".")},A=function(d){return d=d.replace(/&/g,"&amp;"),d=d.replace(/</g,"&lt;"),d=d.replace(/>/g,"&gt;"),u.extendedChs?(d=d.replace(/\'/g,"&apos;"),d=d.replace(/\"/g,"&quot;"),d=d.replace(b,function(M){return M=M.codePointAt(0),"&#x"+M.toString(16)+";"})):d=d.replace(b,"."),d}};t.VERSION="0.3.4";var r=function(o,a){var u=2;switch(o==0&&(o=1),a){case 2:u=o*8;break;case 8:switch(o){case 1:u=3;break;case 2:u=6;break;case 4:u=11;break;case 8:u=22;break}break;case 10:switch(o){case 1:u=3;break;case 2:u=6;break;case 4:u=10;break;case 8:u=20;break}break;case 16:u=2*o;break}return u},i;typeof Ot<"u"?i=Ot:s===window?i=window:i=s,i.hexy=e,i.Hexy=t,i.maxnumberlen=r})(Ot)});var Ln=q(Pn=>{function Mt(){this.waiters=[]}Mt.prototype.wait=function(s){var e=this,t={};this.waiters.push(t);var r=new Promise(function(i){var o=!1;t.resolve=function(a){if(!o){if(o=!0,t.timeout&&(clearTimeout(t.timeout),t.timeout=null),!a){var u=e.waiters.indexOf(t);u>-1&&e.waiters.splice(u,1)}i()}}});return s>0&&isFinite(s)&&(t.timeout=setTimeout(function(){t.timeout=null,t.resolve()},s)),r};Mt.prototype.notify=function(){this.waiters.length>0&&this.waiters.pop().resolve(!0)};Mt.prototype.notifyAll=function(){for(var s=this.waiters.length-1;s>=0;s--)this.waiters[s].resolve(!0);this.waiters=[]};Pn.Subject=Mt});var Bn=q(zt=>{"use strict";zt.byteLength=fi;zt.toByteArray=vi;zt.fromByteArray=Ri;var le=[],Z=[],mi=typeof Uint8Array<"u"?Uint8Array:Array,Ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Se=0,kn=Ss.length;Se<kn;++Se)le[Se]=Ss[Se],Z[Ss.charCodeAt(Se)]=Se;var Se,kn;Z["-".charCodeAt(0)]=62;Z["_".charCodeAt(0)]=63;function Cn(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function fi(s){var e=Cn(s),t=e[0],r=e[1];return(t+r)*3/4-r}function bi(s,e,t){return(e+t)*3/4-t}function vi(s){var e,t=Cn(s),r=t[0],i=t[1],o=new mi(bi(s,r,i)),a=0,u=i>0?r-4:r,c;for(c=0;c<u;c+=4)e=Z[s.charCodeAt(c)]<<18|Z[s.charCodeAt(c+1)]<<12|Z[s.charCodeAt(c+2)]<<6|Z[s.charCodeAt(c+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=e&255;return i===2&&(e=Z[s.charCodeAt(c)]<<2|Z[s.charCodeAt(c+1)]>>4,o[a++]=e&255),i===1&&(e=Z[s.charCodeAt(c)]<<10|Z[s.charCodeAt(c+1)]<<4|Z[s.charCodeAt(c+2)]>>2,o[a++]=e>>8&255,o[a++]=e&255),o}function Di(s){return le[s>>18&63]+le[s>>12&63]+le[s>>6&63]+le[s&63]}function yi(s,e,t){for(var r,i=[],o=e;o<t;o+=3)r=(s[o]<<16&16711680)+(s[o+1]<<8&65280)+(s[o+2]&255),i.push(Di(r));return i.join("")}function Ri(s){for(var e,t=s.length,r=t%3,i=[],o=16383,a=0,u=t-r;a<u;a+=o)i.push(yi(s,a,a+o>u?u:a+o));return r===1?(e=s[t-1],i.push(le[e>>2]+le[e<<4&63]+"==")):r===2&&(e=(s[t-2]<<8)+s[t-1],i.push(le[e>>10]+le[e>>4&63]+le[e<<2&63]+"=")),i.join("")}});var Si={};Yn(Si,{activate:()=>wi,deactivate:()=>xi});module.exports=ei(Si);var Is=ce(require("net")),Fe=ce(require("vscode")),Un=require("crypto"),Mn=require("os"),Es=require("path"),zn=require("process");var v=ce(Rr()),Tn=ce(xr());var En=require("events");var z=(o=>(o[o.UNKNOWN=0]="UNKNOWN",o[o.DB=1]="DB",o[o.DW=2]="DW",o[o.DD=4]="DD",o[o.DQ=8]="DQ",o))(z||{});function*hi(){let s=0;for(;;)yield++s}var gi=hi(),Sr=()=>gi.next().value??-1;var me=class{constructor(e=1,t=1){this.line=e;this.column=t}};var Ge=(d=>(d[d.NUMBER=0]="NUMBER",d[d.IDENTIFIER=1]="IDENTIFIER",d[d.STRING=2]="STRING",d[d.COMMENT=3]="COMMENT",d[d.LPAREN=4]="LPAREN",d[d.RPAREN=5]="RPAREN",d[d.LSQUARE=6]="LSQUARE",d[d.RSQUARE=7]="RSQUARE",d[d.COMMA=8]="COMMA",d[d.COLON=9]="COLON",d[d.QMARK=10]="QMARK",d[d.PLUS=11]="PLUS",d[d.MINUS=12]="MINUS",d[d.END=13]="END",d[d.UNKNOWN=14]="UNKNOWN",d[d.NEWLINE=15]="NEWLINE",d))(Ge||{}),P=class{constructor(e,t,r=new me){this.type=e;this.lexeme=t;this.pos=r;this.id=Sr()}toString(){return`|${this.id}|${Ge[this.type]}|${this.lexeme}|Line ${this.pos.line} Column ${this.pos.column}|`}};var $=class extends Error{constructor(e,t){super(`Encountered error at line ${t.pos.line} column ${t.pos.column}: ${e}`);this.message=e;this.token=t}},ee=class extends ${constructor(e){super(`Invalid token "${e.lexeme}"`,e)}},Ht=class extends ${constructor(e){super(`Invalid immediate "${e.lexeme}"`,e)}},$t=class extends ${constructor(e){super(`Invalid register "${e.lexeme}"`,e)}},ke=class extends ${constructor(e,t,r){super(`Invalid instruction "${e.lexeme}${t?` ${[t?.lexeme,r?.lexeme].join(", ")}`:""}"`,e);this.op1=t;this.op2=r}};var Ce=class extends ${constructor(e){super(`Invalid label "${e.lexeme}"`,e)}},Xt=class extends ${constructor(e){super(`Invalid data ${e.lexeme}`,e)}},Jt=class extends ${constructor(e){super(`Invalid segment ${e.lexeme}`,e)}},Qt=class extends ${constructor(e){super(`Invalid procedure ${e.lexeme}`,e)}};var Kt=class extends ${constructor(e){super("Unterminated quote",e)}},Zt=class extends ${constructor(e){super("Unterminated bracket",e)}},Yt=class extends ${constructor(e){super("Unterminated segment",e)}},es=class extends ${constructor(e){super("Unterminated procedure",e)}};function de(s){if(!/^-?(([0-9]+|[0-9a-f]+h)|[10]+b)$/i.test(s))return null;let e=NaN;return/^-?[01]+b$/i.test(s)?e=parseInt(s,2):/^-?[0-9][0-9a-f]*h$/i.test(s)?e=parseInt(s,16):e=parseInt(s),Number.isNaN(e)?null:{value:e,size:Be(e)}}function Be(s){let e=s<0;e&&(s*=-1);let t=Math.ceil(Math.log2(e?s:s+1)),r=Object.entries(z).filter(([o,a])=>isNaN(Number(o))&&a).map(([o,a])=>[o,Number(a)*8]),i=null;for(let[o,a]of r)if(t<=(e?a-1:a)){i=z[o];break}if(!i)throw Error(`Value ${s} is too large, max ${r[r.length-1][1]} bits are allowed`);return i}function pe(s){let e=0;for(;s!==0;)e+=s&1,s>>=1;return e}function Te(s,e){return new(e===1?Uint8Array:Uint16Array)([s])[0]}function Er(s,e){let t=new DataView(new(e===1?Uint8Array:Uint16Array)([s]).buffer);return e===1?t.getInt8(0):t.getInt16(0,!0)}function O(s,e){return s&(e===1?128:e===2?32768:e===4?2147483648:9223372036854776e3)}var Ir=function(s){this.op1.setValue(s,this.op2.getValue(s))},Pr=function(s){this.op1.setValue(s,this.op2.getValue(s))},Lr=function(s){this.op1.setValue(s,this.op2.getValue(s))},k=function(s){this.op1.setValue(s,this.op2.getValue(s))},Ne=function(s){this.op1.setValue(s,this.op2.getValue(s)),this.op2.setValue(s,this.op1.getValue(s))},kr=function(s){},F=function(s,e=!1,t,r){let i=this.op1.size||this.op2.size,[o,a]=this.getSigned(s);if(o=t??o,a=r??a,o===void 0||a===void 0)throw new ke(this.token,this.op1.token,this.op2.token);let u=Te(o+a+(e?s.registers.FLAG.carry:0),i),c=o<0?1:0,p=a<0?1:0,g=O(u,i)?1:0;s.registers.FLAG.zero=u===0?1:0,s.registers.FLAG.sign=g?1:0,s.registers.FLAG.auxilliary=(o&15)+(a&15)+s.registers.FLAG.carry>15?1:0,s.registers.FLAG.carry=Be(o+a+(e?s.registers.FLAG.carry:0))>i?1:0,s.registers.FLAG.overflow=c===p&&c!==g?1:0,s.registers.FLAG.parity=pe(u&255)%2===0?1:0,this.op1.setValue(s,u)},X=function(s){F.call(this,s,!0)},W=function(s,e=!0){let t=this.op1.size||this.op2.size,[r,i]=this.getUnsigned(s);if(r===void 0||i===void 0)return;let o=Te(r&i,t);s.registers.FLAG.carry=0,s.registers.FLAG.overflow=0,s.registers.FLAG.zero=o===0?1:0,s.registers.FLAG.sign=O(o,t),s.registers.FLAG.parity=pe(o&255)%2===0?1:0,e&&this.op1.setValue(s,o)},G=function(s,e=!0,t=!1,r,i){let o=this.op1.size||this.op2.size,[a,u]=this.getSigned(s);if(a=r??a,u=i??u,a===void 0||u===void 0)throw new ke(this.token,this.op1.token,this.op2.token);let c=Te(a-u-(t?s.registers.FLAG.carry:0),o),p=a<0?1:0,g=u<0?1:0,f=O(c,o)?1:0;s.registers.FLAG.zero=c===0?1:0,s.registers.FLAG.sign=f?1:0,s.registers.FLAG.auxilliary=(u&15)>(a&15)?1:0,s.registers.FLAG.carry=u>a?1:0,s.registers.FLAG.overflow=p!==g&&p!==f?1:0,s.registers.FLAG.parity=pe(c&255)%2===0?1:0,e&&this.op1.setValue(s,c)},J=function(s){G.call(this,s,!1)},Dt=function(s){G.call(this,s,!0,!1,null,1)},Ve=function(s,e=!1){let{size:t}=this.op1,r=e?Er(this.op1.getValue(s),t):Te(this.op1.getValue(s),t);if(r===0){Ds.call(this,s,0);return}let i=e?s.registers.AX.signed:s.registers.AX.value,o=e?s.registers.DX.signed:s.registers.DX.value;if(t===1){let u=i/r;s.registers.AL.value=u<0?Math.ceil(u):Math.floor(u),s.registers.AH.value=i%r}else{let u=o<<16|i;s.registers.AX.value=Math.floor(u/r),s.registers.DX.value=u%r}let a=t===1?s.registers.AL.value:s.registers.AX.value;s.registers.FLAG.zero=a===0?1:0,s.registers.FLAG.parity=pe(a&255)%2===0?1:0,e&&(s.registers.FLAG.sign=a&(t===1?128:32768)?1:0,s.registers.FLAG.carry=Be(a)>t?1:0,s.registers.FLAG.overflow=Be(a)>t?1:0)},yt=function(s){Ve.call(this,s,!0)},qe=function(s,e=!1){let{size:t}=this.op1,r=e?Er(this.op1.getValue(s),t):Te(this.op1.getValue(s),t),i=e?s.registers.AL.signed:s.registers.AL.value,o=e?s.registers.AX.signed:s.registers.AX.value;t===1?s.registers.AX.value=i*r:(s.registers.AX.value=o*r&65535,s.registers.DX.value=o*r&4294901760);let a=t===1?s.registers.AX.value:s.registers.DX.value<<16|s.registers.AX.value;s.registers.FLAG.zero=a===0?1:0,s.registers.FLAG.parity=pe(a&255)%2===0?1:0,s.registers.FLAG.carry=Be(a)>t*2?1:0,e&&(s.registers.FLAG.sign=a&(t===1?128:32768)?1:0,s.registers.FLAG.overflow=O(a,t*2)!==O(t===1?s.registers.AL.value:s.registers.AX.value,t)?1:0)},Rt=function(s){qe.call(this,s,!0)},At=function(s){F.call(this,s,!1,null,1)},wt=function(s){let e=this.op1.getValue(s);s.registers.FLAG.carry=e!==0?1:0,s.registers.FLAG.zero=e===0?1:0,s.registers.FLAG.sign=O(e,this.op1.size)?0:1,s.registers.FLAG.parity=pe(e&255)%2===0?1:0,this.op1.setValue(s,-1*e)},xt=function(s){this.op1.setValue(s,~this.op1.getValue(s))},Q=function(s){let e=this.op1.size||this.op2.size,[t,r]=this.getUnsigned(s);if(t===void 0||r===void 0)return;let i=Te(t|r,e);s.registers.FLAG.zero=i===0?1:0,s.registers.FLAG.sign=O(i,e)?1:0,s.registers.FLAG.parity=pe(i&255)%2===0?1:0,this.op1.setValue(s,i)},fe=function(s,e=!1,t=!1){let r=this.op1.getValue(s),i=this.op2.getValue(s),o,a=s.registers.FLAG.carry;for(let u=0;u<i;u++){let c=a;a=O(r,this.op1.size)?1:0,o=(t?r>>1:r<<1)&(this.op1.size===1?255:65535)|(e?c:a)}s.registers.FLAG.carry=a,this.op1.setValue(s,o)},je=function(s){fe.call(this,s,!0)},He=function(s){fe.call(this,s,!0,!0)},$e=function(s){fe.call(this,s,!1,!0)},be=function(s,e=!1,t=!0){let r=this.op1.getValue(s),i=this.op2.getValue(s),o,a;for(let u=0;u<i;u++)o=(e?r>>1:r<<1)&(this.op1.size===1?255:65535),e&&t&&(a=O(r,this.op1.size)?1:0,o|=this.op1.size===1?a<<7:a<<15);s.registers.FLAG.zero=o===0?1:0,s.registers.FLAG.sign=O(o,this.op1.size)?1:0,s.registers.FLAG.carry=a,s.registers.FLAG.auxilliary=i===1?1:0,s.registers.FLAG.overflow=O(r,this.op1.size)!==O(o,this.op1.size)?1:0,this.op1.setValue(s,o)},Xe=function(s){be.call(this,s,!0)},Je=be,Qe=function(s){be.call(this,s,!0,!1)},U=function(s){G.call(this,s,!0,!0)},te=function(s){W.call(this,s,!1)},V=function(s){let e=this.op1.getValue(s)^this.op2.getValue(s);s.registers.FLAG.overflow=0,s.registers.FLAG.carry=0,s.registers.FLAG.zero=e===0?1:0,s.registers.FLAG.sign=O(e,this.op1.size)?1:0,s.registers.FLAG.parity=pe(e&255)%2===0?1:0,s.registers.FLAG.auxilliary=e&4?1:0,this.op1.setValue(s,e)},w=function(s){if(!this.farptr)this.op1 instanceof x?s.registers.IP.value+=this.op1.getDisp(s)-this.size(s):s.registers.IP.value=this.op1.getSigned(s)-this.size(s);else if(this.op1 instanceof E){let e=this.op1.getAddress(s);s.registers.IP.value=s.memory.get(e,2)-this.size(s),s.registers.CS.value=s.memory.get(e+2,2)}else if(this.op1 instanceof ve)s.registers.IP.value=this.op1.offset.getUnsigned(s)-this.size(s),s.registers.CS.value=this.op1.segment.getUnsigned(s);else if(this.op1 instanceof x){let e=this.op1.getNode(s);if(e instanceof De){if(!e.location)return;let t=e.getSegment(s),r=e.location-t;s.registers.IP.value=r-this.size(s),s.registers.CS.value=t>>4}}},_e=function(s){if(this.op1 instanceof x){let e=this.op1.getNode(s);e instanceof De&&(this.farptr=!e.near)}else this.op1 instanceof ve&&(this.farptr=!0);this.farptr&&s.push(s.registers.CS.value),s.push(s.registers.IP.value+this.size(s)),w.call(this,s)},St=function(s,e=!1){if(s.registers.IP.value=s.pop()-this.size(s),e&&(s.registers.CS.value=s.pop()),this.op1){let t=this.op1.getValue(s);for(let r=0;r<t;r++)s.pop()}},ts=function(s){St.call(this,s,!0)},Et=function(s,e=!0){s.registers.CX.value--,s.registers.CX.value!==0&&e&&(s.registers.IP.value+=this.op1.getDisp(s)-this.size(s))},ss=function(s){Et.call(this,s,s.registers.FLAG.zero)},rs=function(s){Et.call(this,s,!s.registers.FLAG.zero)},Cr=rs,Br=ss,ns=function(s){s.registers.FLAG.carry===0&&s.registers.FLAG.zero===0&&w.call(this,s)},It=function(s){s.registers.FLAG.carry===0&&w.call(this,s)},Pt=function(s){s.registers.FLAG.carry===1&&w.call(this,s)},Tr=Pt,is=function(s){(s.registers.FLAG.carry===1||s.registers.FLAG.zero===1)&&w.call(this,s)},Nr=function(s){s.registers.CX.value===0&&w.call(this,s)},os=function(s){s.registers.FLAG.zero===1&&w.call(this,s)},as=function(s){s.registers.FLAG.zero===0&&s.registers.FLAG.sign===s.registers.FLAG.overflow&&w.call(this,s)},ls=function(s){s.registers.FLAG.sign===s.registers.FLAG.overflow&&w.call(this,s)},us=function(s){s.registers.FLAG.sign!==s.registers.FLAG.overflow&&s.registers.FLAG.zero===0&&w.call(this,s)},cs=function(s){(s.registers.FLAG.zero===1||s.registers.FLAG.sign!==s.registers.FLAG.overflow)&&w.call(this,s)},_r=is,Or=Pt,Fr=It,Ur=It,Mr=ns,ds=function(s){s.registers.FLAG.zero===0&&w.call(this,s)},zr=cs,Wr=us,Gr=ls,Vr=as,qr=function(s){s.registers.FLAG.overflow===0&&w.call(this,s)},ps=function(s){s.registers.FLAG.parity===0&&w.call(this,s)},jr=function(s){s.registers.FLAG.sign===0&&w.call(this,s)},Hr=ds,$r=function(s){s.registers.FLAG.overflow===1&&w.call(this,s)},hs=function(s){s.registers.FLAG.parity===1&&w.call(this,s)},Xr=hs,Jr=ps,Qr=function(s){s.registers.FLAG.sign===1&&w.call(this,s)},Kr=os,gs=function(s){},Zr=function(s){},Yr=function(s){},en=function(s){},ms=function(s){},fs=function(s){},tn=function(s){s.registers.AH.value=O(s.registers.AL.value,1)?255:0},sn=function(s){s.registers.DX.value=O(s.registers.AX.value,2)?65535:0},rn=function(s){},nn=function(s){},on=function(s){},an=function(s){},ln=function(s){},un=function(s){},Lt=function(s){this.op1.setValue(s,s.pop())},bs=function(s){s.registers.FLAG.value=s.pop()},Ke=function(s){s.push(this.op1.getValue(s))},vs=function(s){s.push(s.registers.FLAG.value)},Ds=function(s,e){vs.call(this,s),ys.call(this,s),s.registers.FLAG.trap=0,s.push(s.registers.CS.value),s.push(s.registers.IP.value+this.size(s));let t=e??this.op1.getValue(s)*4;s.registers.IP.value=s.memory.get(t,2)-this.size(s),s.registers.CS.value=s.memory.get(t+2,2)},cn=function(s){},dn=function(s){s.registers.IP.value=s.pop()-this.size(s),s.registers.CS.value=s.pop(),bs.call(this,s)},pn=function(s){s.registers.FLAG.carry=0},hn=function(s){s.registers.FLAG.directional=0},ys=function(s){s.registers.FLAG.interrupt=0},gn=function(s){s.registers.FLAG.carry=~s.registers.FLAG.carry},mn=function(s){s.registers.AH.value=s.registers.FLAG.sign<<7|s.registers.FLAG.zero<<6|s.registers.FLAG.overflow<<5|s.registers.FLAG.auxilliary<<4|s.registers.FLAG.overflow<<3|s.registers.FLAG.parity<<2|s.registers.FLAG.interrupt<<1|s.registers.FLAG.carry},fn=function(s){s.registers.FLAG.sign=s.registers.AH.value&128,s.registers.FLAG.zero=s.registers.AH.value&64,s.registers.FLAG.auxilliary=s.registers.AH.value&16,s.registers.FLAG.parity=s.registers.AH.value&4,s.registers.FLAG.carry=s.registers.AH.value&1},bn=function(s){s.registers.FLAG.carry=1},vn=function(s){s.registers.FLAG.directional=1},Dn=function(s){s.registers.FLAG.interrupt=1},yn=function(){};var D=class{constructor(e,t=r=>r.token.lexeme.toUpperCase()===e){this.name=e;this.isValid=t}},n={AH:new D("AH"),AL:new D("AL"),AX:new D("AX"),BH:new D("BH"),BL:new D("BL"),BRANCH:new D("BRANCH",s=>s instanceof x),BX:new D("BX"),CH:new D("CH"),CL:new D("CL"),CS:new D("CS"),CX:new D("CX"),DADDR:new D("DADDR",s=>s instanceof E),DATA8:new D("DATA8",s=>s instanceof B&&s.size===1),DATA16:new D("DATA16",s=>s instanceof B&&s.size<=2),DH:new D("DH"),DI:new D("DI"),DISP:new D("DISP",s=>s instanceof x),DISP8:new D("DISP8",s=>s instanceof x),DL:new D("DL"),DS:new D("DS"),DX:new D("DX"),ES:new D("ES"),SEGOFF:new D("SEGOFF",s=>s instanceof ve),LABEL:new D("LABEL",s=>s instanceof x),N:new D("N",s=>s instanceof B&&s.getValue()>=0&&s.getValue()<=7),PC:new D("PC"),RB:new D("RB",s=>s instanceof _&&["AH","AL","BH","BL","CH","CL","DH","DL"].includes(s.register)),RW:new D("RW",s=>s instanceof _&&["AX","BX","CX","DX","SP","BP","SI","DI"].includes(s.register)),SEGM:new D("SEGM"),SI:new D("SI"),SP:new D("SP"),SR:new D("SR",s=>s instanceof _&&["CS","DS","ES","SS"].includes(s.register)),SS:new D("SS")};var Ze={AL:"000",AX:"000",CL:"001",CX:"001",DL:"010",DX:"010",BL:"011",BX:"011",AH:"100",SP:"100",CH:"100",BP:"100",DH:"100",SI:"100",BH:"100",DI:"100",ES:"00",CS:"01",SS:"10",DS:"11"},l=class{constructor(e,t,r,i,o){this.mnemonic=e;this.op1=t;this.op2=r;this.executor=i;this.format=o}getBinary(e,t){let r=this.format.replace(/\s/g,""),i=/{mod}/i.test(r),o=/{reg}/i.test(r),a=/{seg}/i.test(r),u=/{rm}/i.test(r),c=/{label}/i.test(r),p=/{disp}/i.test(r),g=/{yy}/i.test(r),f=/{yyyy}/i.test(r),b=r,S=new Uint16Array(1),L=new DataView(S.buffer);if(o&&(t.op1 instanceof _?b=b.replace(/{reg}/,Ze[t.op1.register]):t.op2 instanceof _&&(b=b.replace(/{reg}/,Ze[t.op2.register]))),a&&(t.op1 instanceof _?b=b.replace(/{seg}/,Ze[t.op1.register]):t.op2 instanceof _&&(b=b.replace(/{seg}/,Ze[t.op2.register]))),i&&u)if(t.op1 instanceof _&&t.op2 instanceof _)b=b.replace(/{mod}/,"11"),b=b.replace(/{rm}/,Ze[t.op2.register]);else{let A=t.op1 instanceof E?t.op1:t.op2;A instanceof E&&(!A.bpbx&&!A.sidi?(b=b.replace(/{mod}/,"00"),b=b.replace(/{rm}/,"110")):(b=b.replace(/{mod}/,A.imm?A.imm.size===1?"01":"11":"00"),A.bpbx&&A.sidi?b=b.replace(/{rm}/,`0${/BX/i.test(A.bpbx.register)?0:1}${/SI/i.test(A.bpbx.register)?0:1}`):A.bpbx?b=b.replace(/{rm}/,`11${/BX/i.test(A.bpbx.register)?1:0}`):A.sidi&&(b=b.replace(/{rm}/,`10${/SI/i.test(A.sidi.register)?0:1}`))))}if(c){let A=t.op1 instanceof x?t.op1:t.op2;A instanceof x&&(S[0]=A.getValue(e),b=b.replace(/{label}/,L.getUint16(0,!0).toString(2).padStart(16,"0")))}if(p){let A=t.op1 instanceof E?t.op1:t.op2;if(A instanceof E&&A.imm)S[0]=A.imm.getValue(e),b=b.replace(/{disp}/,[L.getUint8(0),L.getUint8(1)].map(d=>d.toString(2).padStart(8,"0")).join(""));else{let d=t.op1 instanceof x?t.op1:t.op2;d instanceof x&&(S[0]=d.getValue(e),b=b.replace(/{disp}/,L.getUint8(0).toString(2).padStart(8,"0")))}}if(g||f){let A=t.op1 instanceof B?t.op1:t.op2;A instanceof B&&(S[0]=A.getValue(e),g?b=b.replace(/{yy}/,L.getUint8(0).toString(2).padStart(8,"0")):b=b.replace(/{yyyy}/,L.getUint16(0,!0).toString(2).padStart(16,"0")))}return b.replace(/[^01]/g,"")}},Rs=[new l("LDS",n.RW,n.DADDR,Ir,"1100 0101 {mod} {reg} {rm} {disp}"),new l("LEA",n.RW,n.DADDR,Pr,"1000 1101 {mod} {reg} {rm} {disp}"),new l("LES",n.RW,n.DADDR,Lr,"1100 0100 {mod} {reg} {rm} {disp}"),new l("MOV",n.RB,n.DADDR,k,"1000 1010 {mod} {reg} {rm} {disp}"),new l("MOV",n.RW,n.DADDR,k,"1000 1011 {mod} {reg} {rm} {disp}"),new l("MOV",n.DADDR,n.RB,k,"1000 1000 {mod} {reg} {rm} {disp}"),new l("MOV",n.DADDR,n.RW,k,"1000 1001 {mod} {reg} {rm} {disp}"),new l("MOV",n.AL,n.LABEL,k,"1010 0000 {label}"),new l("MOV",n.AX,n.LABEL,k,"1010 0001 {label}"),new l("MOV",n.LABEL,n.AL,k,"1010 0010 {label}"),new l("MOV",n.LABEL,n.AX,k,"1010 0011 {label}"),new l("MOV",n.SR,n.DADDR,k,"1000 1110 {mod} {seg} {rm} {disp}"),new l("MOV",n.DADDR,n.SR,k,"1000 1100 {mod} {seg} {rm} {disp}"),new l("XCHG",n.RB,n.DADDR,Ne,"1000 0110 {mod} {reg} {rm} {disp}"),new l("XCHG",n.RW,n.DADDR,Ne,"1000 0110 {mod} {reg} {rm} {disp}"),new l("XLAT",null,null,kr,"1101 0111"),new l("ADC",n.RB,n.DADDR,X,"0001 0010 {mod} {reg} {rm} {disp}"),new l("ADC",n.RW,n.DADDR,X,"0001 0011 {mod} {reg} {rm} {disp}"),new l("ADC",n.DADDR,n.RB,X,"0001 0000 {mod} {reg} {rm} {disp}"),new l("ADC",n.DADDR,n.RW,X,"0001 0001 {mod} {reg} {rm} {disp}"),new l("ADD",n.RB,n.DADDR,F,"0000 0010 {mod} {reg} {rm} {disp}"),new l("ADD",n.RW,n.DADDR,F,"0000 0011 {mod} {reg} {rm} {disp}"),new l("ADD",n.DADDR,n.RB,F,"0000 0000 {mod} {reg} {rm} {disp}"),new l("ADD",n.DADDR,n.RW,F,"0000 0001 {mod} {reg} {rm} {disp}"),new l("AND",n.RW,n.DADDR,W,"0010 0010 {mod} {reg} {rm} {disp}"),new l("AND",n.RB,n.DADDR,W,"0010 0011 {mod} {reg} {rm} {disp}"),new l("AND",n.DADDR,n.RW,W,"0010 0001 {mod} {reg} {rm} {disp}"),new l("AND",n.DADDR,n.RB,W,"0010 0000 {mod} {reg} {rm} {disp}"),new l("CMP",n.RB,n.DADDR,J,"0011 1010 {mod} {reg} {rm} {disp}"),new l("CMP",n.RW,n.DADDR,J,"0011 1011 {mod} {reg} {rm} {disp}"),new l("CMP",n.DADDR,n.RW,J,"0011 1001 {mod} {reg} {rm} {disp}"),new l("CMP",n.DADDR,n.RB,J,"0011 1000 {mod} {reg} {rm} {disp}"),new l("DEC",n.DADDR,null,Dt,"1111 1110 {mod} 001 {rm} {disp}"),new l("DIV",n.DADDR,null,Ve,"1111 0110 {mod} 110 {rm} {disp}"),new l("IDIV",n.DADDR,null,yt,"1111 0110 {mod} 111 {rm} {disp}"),new l("IMUL",n.DADDR,null,Rt,"1111 0110 {mod} 101 {rm} {disp}"),new l("INC",n.DADDR,null,At,"1111 1110 {mod} 000 {rm} {disp}"),new l("MUL",n.DADDR,null,qe,"1111 0110 {mod} 100 {rm} {disp}"),new l("NEG",n.DADDR,null,wt,"1111 0110 {mod} 011 {rm} {disp}"),new l("NOT",n.DADDR,null,xt,"1111 0110 {mod} 010 {rm} {disp}"),new l("OR",n.RB,n.DADDR,Q,"0000 1010 {mod} {reg} {rm} {disp}"),new l("OR",n.RW,n.DADDR,Q,"0000 1011 {mod} {reg} {rm} {disp}"),new l("OR",n.DADDR,n.RB,Q,"0000 1000 {mod} {reg} {rm} {disp}"),new l("OR",n.DADDR,n.RW,Q,"0000 1001 {mod} {reg} {rm} {disp}"),new l("RCL",n.DADDR,n.N,je,"1101 0000 {mod} 011 {rm} {disp}"),new l("ROL",n.DADDR,n.N,fe,"1101 0000 {mod} 000 {rm} {disp}"),new l("RCR",n.DADDR,n.N,He,"1101 0000 {mod} 001 {rm} {disp}"),new l("ROR",n.DADDR,n.N,$e,"1101 0000 {mod} 000 {rm} {disp}"),new l("RCL",n.DADDR,n.CL,je,"1101 0010 {mod} 011 {rm} {disp}"),new l("ROL",n.DADDR,n.CL,fe,"1101 0010 {mod} 000 {rm} {disp}"),new l("RCR",n.DADDR,n.CL,He,"1101 0010 {mod} 001 {rm} {disp}"),new l("ROR",n.DADDR,n.CL,$e,"1101 0010 {mod} 000 {rm} {disp}"),new l("SAL",n.DADDR,n.N,be,"1101 0000 {mod} 001 {rm} {disp}"),new l("SAR",n.DADDR,n.N,Xe,"1101 0000 {mod} 111 {rm} {disp}"),new l("SAL",n.DADDR,n.CL,be,"1101 0010 {mod} 001 {rm} {disp}"),new l("SAR",n.DADDR,n.CL,Xe,"1101 0010 {mod} 111 {rm} {disp}"),new l("SBB",n.RB,n.DADDR,U,"1111 1010 {mod} {reg} {rm} {disp}"),new l("SBB",n.RW,n.DADDR,U,"1111 1011 {mod} {reg} {rm} {disp}"),new l("SBB",n.DADDR,n.RB,U,"1111 1000 {mod} {reg} {rm} {disp}"),new l("SBB",n.DADDR,n.RW,U,"1111 1001 {mod} {reg} {rm} {disp}"),new l("SHR",n.DADDR,n.N,Qe,"1111 0000 {mod} 101 {rm} {disp}"),new l("SHL",n.DADDR,n.N,Je,"1111 0001 {mod} 101 {rm} {disp}"),new l("SHR",n.DADDR,n.CL,Qe,"1111 0010 {mod} 101 {rm} {disp}"),new l("SHL",n.DADDR,n.CL,Je,"1111 0011 {mod} 101 {rm} {disp}"),new l("SUB",n.RB,n.DADDR,G,"0010 1010 {mod} {reg} {rm} {disp}"),new l("SUB",n.RW,n.DADDR,G,"0010 1011 {mod} {reg} {rm} {disp}"),new l("SUB",n.DADDR,n.RB,G,"0010 1000 {mod} {reg} {rm} {disp}"),new l("SUB",n.DADDR,n.RW,G,"0010 1001 {mod} {reg} {rm} {disp}"),new l("TEST",n.DADDR,n.RB,te,"1000 0100 {mod} {reg} {rm} {disp}"),new l("TEST",n.DADDR,n.RW,te,"1000 0101 {mod} {reg} {rm} {disp}"),new l("XOR",n.RB,n.DADDR,V,"0011 0010 {mod} {reg} {rm} {disp}"),new l("XOR",n.RW,n.DADDR,V,"0011 0011 {mod} {reg} {rm} {disp}"),new l("XOR",n.DADDR,n.RB,V,"0011 0000 {mod} {reg} {rm} {disp}"),new l("XOR",n.DADDR,n.RW,V,"0011 0001 {mod} {reg} {rm} {disp}"),new l("MOV",n.DADDR,n.DATA8,k,"1100 0110 {mod} 000 {rm} {disp} {yy}"),new l("MOV",n.DADDR,n.DATA16,k,"1100 0111 {mod} 000 {rm} {disp} {yyyy}"),new l("MOV",n.RB,n.DATA8,k,"1011 1 {reg} {yy}"),new l("MOV",n.RW,n.DATA16,k,"1011 1 {reg} {yyyy}"),new l("JMP",n.BRANCH,null,w,"1110 1001 {reg} {disp}"),new l("JMP",n.DATA16,null,w,"1110 1001 {reg} {disp}"),new l("JMP",n.DADDR,null,w,"1111 1111 {mod} 100 {rm} {disp}"),new l("JMP FAR PTR",n.DADDR,null,w,"1111 1111 {mod} 101 {rm} {disp}"),new l("JMP",n.SEGOFF,null,w,"1110 1010 {yyyy}"),new l("JMP",n.RW,null,w,"1111 1111 1110 0 {reg}"),new l("CALL",n.BRANCH,null,_e,"1110 1000 {disp}"),new l("CALL",n.DADDR,null,_e,"1111 1111 {mod} 010 {reg} {disp}"),new l("CALL FAR PTR",n.DADDR,null,_e,"1111 1111 {mod} 011 {rm} {disp}"),new l("CALL",n.SEGOFF,null,_e,"1001 1010 {yyyy}"),new l("CALL",n.RW,null,_e,"1111 1101 0 {rm}"),new l("RET",null,null,St,"1100 0011"),new l("RET",n.DATA16,null,St,"1100 0010 {yyyy}"),new l("RETF",null,null,ts,"1101 0011"),new l("RETF",n.DATA16,null,ts,"1101 0010 {yyyy}"),new l("ADD",n.AL,n.DATA8,F,"0000 0100 {yy}"),new l("ADD",n.AX,n.DATA16,F,"0000 0101 {yyyy}"),new l("ADD",n.RB,n.DATA8,F,"1000 0000 1100 0 {reg} {yy}"),new l("ADD",n.RW,n.DATA16,F,"1000 0001 1100 0 {reg} {yyyy}"),new l("ADD",n.DADDR,n.DATA8,F,"1000 0000 {mod} 000 {rm} {yy}"),new l("ADD",n.DADDR,n.DATA16,F,"1000 0001 {mod} 000 {rm} {yyyy}"),new l("ADC",n.AL,n.DATA8,X,"0001 0100 {yy}"),new l("ADC",n.AX,n.DATA16,X,"0001 0101 {yyyy}"),new l("ADC",n.RB,n.DATA8,X,"1000 0000 1101 {reg} {yy}"),new l("ADC",n.RW,n.DATA16,X,"1000 0001 1101 {reg} {yyyy}"),new l("ADC",n.DADDR,n.DATA8,X,"1000 0000 {mod} 010 {rm} {disp} {yy}"),new l("ADC",n.DADDR,n.DATA16,X,"1000 0001 {mod} 010 {rm} {disp} {yyyy}"),new l("AND",n.AL,n.DATA8,W,"0010 0100 {yy}"),new l("AND",n.AX,n.DATA16,W,"0010 0101 {yyyy}"),new l("AND",n.RB,n.DATA8,W,"1000 0000 1110 0 {reg} {yy}"),new l("AND",n.RW,n.DATA16,W,"1000 0001 1110 0 {reg} {yyyy}"),new l("AND",n.DADDR,n.DATA8,W,"1000 0000 {reg} 100 {rm} {disp} {yy}"),new l("AND",n.DADDR,n.DATA16,W,"1000 0001 {mod} 100 {rm} {disp} {yyyy}"),new l("CMP",n.AL,n.DATA8,J,"0011 1100 {yy}"),new l("CMP",n.AX,n.DATA16,J,"0011 1101 {yyyy}"),new l("CMP",n.RB,n.DATA8,J,"1000 0000 1111 1 {reg} {yy}"),new l("CMP",n.RW,n.DATA16,J,"1000 0001 1111 {reg} {yyyy}"),new l("CMP",n.DADDR,n.DATA8,J,"1000 0000 {mod} 111 {rm} {disp} {yy}"),new l("CMP",n.DADDR,n.DATA16,J,"1000 0001 {mod} 111 {rm} {disp} {yyyy}"),new l("OR",n.AL,n.DATA8,Q,"0000 1100 {yy}"),new l("OR",n.AX,n.DATA16,Q,"0000 1101 {yyyy}"),new l("OR",n.RB,n.DATA8,Q,"1000 0000 1100 01 {reg} {yyyy}"),new l("OR",n.RW,n.DATA16,Q,"1000 0001 1100 01 {reg} {yyyy}"),new l("OR",n.DADDR,n.DATA8,Q,"1000 0000 {mod} 001 {rm} {disp} {yyyy}"),new l("OR",n.DADDR,n.DATA16,Q,"1000 0001 {mod} 001 {rm} {disp} {yyyy}"),new l("SBB",n.AL,n.DATA8,U,"0001 1100 0 {yy}"),new l("SBB",n.AX,n.DATA16,U,"0001 11001 {yyyy}"),new l("SBB",n.RW,n.DATA16,U,"1000 0000 1100 01 {reg} {yyyy}"),new l("SBB",n.RB,n.DATA8,U,"1000 0001 1101 {reg} {disp} {yy}"),new l("SBB",n.DADDR,n.DATA8,U,"1000 0000 {mod} 001 {rm} {disp} {yyyy}"),new l("SBB",n.DADDR,n.DATA16,U,"1000 0001 {mod} 001 {rm} {disp} {yyyy}"),new l("SUB",n.AL,n.DATA8,G,"0010 1100 {yy}"),new l("SUB",n.AX,n.DATA16,G,"0010 1101 {yyyy}"),new l("SUB",n.RB,n.DATA8,G,"1000 0000 1110 1 {reg} {yy}"),new l("SUB",n.RW,n.DATA16,G,"1000 0001 1110 1 {reg} {yyyy}"),new l("SUB",n.DADDR,n.DATA8,G,"1000 0000 {mod} 101 {rm} {disp} {yy}"),new l("SUB",n.DADDR,n.DATA16,G,"1000 0001 {mod} 101 {rm} {disp} {yyyy}"),new l("TEST",n.AL,n.DATA8,te,"1010 1000 {yy}"),new l("TEST",n.AX,n.DATA16,te,"1010 1001 {yyyy}"),new l("TEST",n.RB,n.DATA8,te,"1111 0110 1100 0 {reg} {yy}"),new l("TEST",n.RW,n.DATA16,te,"1111 0111 1100 0 {reg} {yyyy}"),new l("TEST",n.DADDR,n.DATA8,te,"1111 0110 {mod} 000 {rm} {disp} {yy}"),new l("TEST",n.DADDR,n.DATA16,te,"1111 0111 {mod} 000 {rm} {disp} {yyyy}"),new l("XOR",n.AL,n.DATA8,V,"0011 0100 {yy}"),new l("XOR",n.AX,n.DATA16,V,"0011 0101 {yyyy}"),new l("XOR",n.RB,n.DATA8,V,"1000 0000 1111 0 {reg} {yy}"),new l("XOR",n.RW,n.DATA16,V,"1000 0001 1100 0 {reg} {yyyy}"),new l("XOR",n.DADDR,n.DATA8,V,"1000 0000 {mod} 010 {rm} {disp} {yy}"),new l("XOR",n.DADDR,n.DATA16,V,"1000 0001 {mod} 010 {rm} {disp} {yyyy}"),new l("LOOP",n.DISP8,null,Et,"1110 0010 {disp}"),new l("LOOPE",n.DISP8,null,ss,"1110 0001 {disp}"),new l("LOOPNE",n.DISP8,null,rs,"1110 0000 {disp}"),new l("LOOPNZ",n.DISP8,null,Cr,"1110 0000 {disp}"),new l("LOOPZ",n.DISP8,null,Br,"1110 0001 {disp}"),new l("JA",n.DISP8,null,ns,"0111 0111 {disp}"),new l("JAE",n.DISP8,null,It,"0111 0011 {disp}"),new l("JB",n.DISP8,null,Pt,"0111 0010 {disp}"),new l("JC",n.DISP8,null,Tr,"0111 0010 {disp}"),new l("JBE",n.DISP8,null,is,"0111 0110 {disp}"),new l("JCXZ",n.DISP8,null,Nr,"1110 0011 {disp}"),new l("JE",n.DISP8,null,os,"0111 0100 {disp}"),new l("JG",n.DISP8,null,as,"0111 1111 {disp}"),new l("JGE",n.DISP8,null,ls,"0111 1101 {disp}"),new l("JL",n.DISP8,null,us,"0111 1100 {disp}"),new l("JLE",n.DISP8,null,cs,"0111 1110 {disp}"),new l("JNA",n.DISP8,null,_r,"0111 0110 {disp}"),new l("JNAE",n.DISP8,null,Or,"0111 0010 {disp}"),new l("JNB",n.DISP8,null,Fr,"0111 0111 {disp}"),new l("JNC",n.DISP8,null,Ur,"0111 0111 {disp}"),new l("JNBE",n.DISP8,null,Mr,"0111 0111 {disp}"),new l("JNE",n.DISP8,null,ds,"0111 0101 {disp}"),new l("JNG",n.DISP8,null,zr,"0111 0111 {disp}"),new l("JNGE",n.DISP8,null,Wr,"0111 0111 {disp}"),new l("JNL",n.DISP8,null,Gr,"0111 0111 {disp}"),new l("JNLE",n.DISP8,null,Vr,"0111 0111 {disp}"),new l("JNO",n.DISP8,null,qr,"0111 0001 {disp}"),new l("JNP",n.DISP8,null,ps,"0111 1011 {disp}"),new l("JNS",n.DISP8,null,jr,"0111 1001 {disp}"),new l("JNZ",n.DISP8,null,Hr,"0111 0111 {disp}"),new l("JO",n.DISP8,null,$r,"0111 0000 {disp}"),new l("JP",n.DISP8,null,hs,"0111 1010 {disp}"),new l("JPE",n.DISP8,null,Xr,"0111 0111 {disp}"),new l("JPO",n.DISP8,null,Jr,"0111 0111 {disp}"),new l("JS",n.DISP8,null,Qr,"0111 1000 {disp}"),new l("JZ",n.DISP8,null,Kr,"0111 0111 {disp}"),new l("MOV",n.RB,n.RB,k,"1000 1010 11 {reg} {reg}"),new l("MOV",n.RW,n.RW,k,"1000 1011 11 {reg} {reg}"),new l("MOV",n.SR,n.RW,k,"1000 1110 110 {seg} {reg}"),new l("MOV",n.RW,n.SR,k,"1000 1100 110 {seg} {reg}"),new l("XCHG",n.AX,n.RW,Ne,"1001 0 {reg}"),new l("XCHG",n.RB,n.RB,Ne,"1000 0110 11 {reg} {reg}"),new l("XCHG",n.RB,n.RB,Ne,"1000 0111 11 {reg} {reg}"),new l("CMPS",null,null,gs,"1010 0110"),new l("CMPS",null,null,gs,"1010 0111"),new l("LODS",null,null,Zr,"1010 1100"),new l("MOVS",null,null,Yr,"1010 0101"),new l("REP",n.N,null,en,"1111 0010"),new l("SCAS",null,null,ms,"1010 1110"),new l("SCAS",null,null,ms,"1010 1111"),new l("STOS",null,null,fs,"1010 1010"),new l("STOS",null,null,fs,"1010 1011"),new l("ADC",n.RB,n.RB,X,"0001 0010 11 {reg} {reg}"),new l("ADC",n.RW,n.RW,X,"0001 0011 11 {reg} {reg}"),new l("ADD",n.RB,n.RB,F,"0000 0010 11 {reg} {reg}"),new l("ADD",n.RW,n.RW,F,"0000 0011 11 {reg} {reg}"),new l("AND",n.RB,n.RB,W,"0010 0010 11 {reg} {reg}"),new l("AND",n.RB,n.RB,W,"0010 0011 11 {reg} {reg}"),new l("CBW",null,null,tn,"1001 1000"),new l("CMP",n.RB,n.RB,J,"0011 1010 11 {reg} {reg}"),new l("CMP",n.RW,n.RW,J,"0011 1011 11 {reg} {reg}"),new l("CWD",null,null,sn,"1001 1001"),new l("DIV",n.RB,null,Ve,"1111 0110 1111 0 {reg}"),new l("DIV",n.RW,null,Ve,"1111 0111 1111 0 {reg}"),new l("IDIV",n.RB,null,yt,"1111 0110 1111 1 {reg}"),new l("IDIV",n.RW,null,yt,"1111 0111 1111 1 {reg}"),new l("IMUL",n.RB,null,Rt,"1111 0110 1110 1 {reg}"),new l("IMUL",n.RW,null,Rt,"1111 0111 1110 1 {reg}"),new l("MUL",n.RB,null,qe,"1111 0110 1110 0 {reg}"),new l("MUL",n.RW,null,qe,"1111 0111 1110 0 {reg}"),new l("OR",n.RB,null,Q,"0000 1010 11 {reg} {reg}"),new l("OR",n.RW,null,Q,"0000 1011 11 {reg} {reg}"),new l("SBB",n.RB,null,U,"0001 1010 11 {reg} {reg}"),new l("SBB",n.RW,null,U,"0001 1011 11 {reg} {reg}"),new l("SBB",n.RB,null,U,"0010 1010 11 {reg} {reg}"),new l("SBB",n.RW,null,U,"0010 1011 11 {reg} {reg}"),new l("TEST",n.RB,null,te,"1000 0100 11 {reg} {reg}"),new l("TEST",n.RW,null,te,"1000 0101 11 {reg} {reg}"),new l("XOR",n.RB,null,V,"0011 0000 11 {reg} {reg}"),new l("XOR",n.RW,null,V,"0011 0001 11 {reg} {reg}"),new l("XOR",n.RB,null,V,"0011 0000 11 {reg} {reg}"),new l("AAA",null,null,rn,"0011 1111"),new l("AAD",null,null,nn,"1101 0101 0000 1010"),new l("AAM",null,null,on,"1101 0100 0000 1010"),new l("AAS",null,null,an,"0011 1111"),new l("DAA",null,null,ln,"0010 0111"),new l("DAS",null,null,un,"0010 1111"),new l("DEC",n.RB,null,Dt,"1111 1110 1110 1 {reg}"),new l("DEC",n.RW,null,Dt,"0100 1 {reg}"),new l("INC",n.RB,null,At,"1111 1110 0 {reg}"),new l("INC",n.RW,null,At,"0100 0 {reg}"),new l("NEG",n.RB,null,wt,"1111 0110 1101 1 {reg}"),new l("NEG",n.RW,null,wt,"1111 0111 1101 1 {reg}"),new l("NOT",n.RB,null,xt,"1111 0110 1101 0 {reg}"),new l("NOT",n.RW,null,xt,"1111 0111 1101 0 {reg}"),new l("RCL",n.RB,n.N,je,"1101 0000 1101 0 {reg}"),new l("RCL",n.RW,n.N,je,"1101 0001 1101 0 {reg}"),new l("RCR",n.RB,n.N,He,"1101 0000 1101 1 {reg}"),new l("RCR",n.RW,n.N,He,"1101 0001 1101 1 {reg}"),new l("ROL",n.RB,n.N,fe,"1101 0000 1100 0 {reg}"),new l("ROL",n.RW,n.N,fe,"1101 0001 1100 0 {reg}"),new l("ROR",n.RB,n.N,$e,"1101 0000 1100 1 {reg}"),new l("ROR",n.RW,n.N,$e,"1101 0001 1100 1 {reg}"),new l("SAL",n.RB,n.N,be,"1101 0000 1110 0 {reg}"),new l("SAL",n.RW,n.N,be,"1101 0001 1110 0 {reg}"),new l("SAR",n.RB,n.N,Xe,"1101 0000 1111 1 {reg}"),new l("SAR",n.RW,n.N,Xe,"1101 0001 1111 1 {reg}"),new l("SHL",n.RB,n.N,Je,"1101 0000 1110 1 {reg}"),new l("SHL",n.RW,n.N,Je,"1101 0010 1110 1 {reg}"),new l("SHR",n.RB,n.N,Qe,"1101 0000 1110 1 {reg}"),new l("SHR",n.RW,n.N,Qe,"1101 0001 1110 1 {reg}"),new l("POP",n.DADDR,null,Lt,"1000 1111 {mod} 000 {rm} {disp}"),new l("POP",n.RW,null,Lt,"0101 1 {reg}"),new l("POP",n.SR,null,Lt,"000 {seg} 111"),new l("POPF",null,null,bs,"1001 1101"),new l("PUSH",n.DADDR,null,Ke,"1111 1111 {mod} 110 {rm} {disp}"),new l("PUSH",n.RW,null,Ke,"0101 0 {reg}"),new l("PUSH",n.SR,null,Ke,"000 {seg} 110"),new l("PUSH",n.SR,null,Ke,"1001 1100"),new l("PUSHF",null,null,vs,"0001 0000"),new l("INT",n.DATA8,null,Ds,"1100 1100"),new l("INTO",null,null,cn,"1100 1110"),new l("IRET",null,null,dn,"1100 1111"),new l("CLC",null,null,pn,"1111 1000"),new l("CLD",null,null,hn,"1111 1100"),new l("CLI",null,null,ys,"1111 1010"),new l("CMC",null,null,gn,"1111 0101"),new l("LAHF",null,null,mn,"1001 1111"),new l("SAHF",null,null,fn,"1001 1110"),new l("STC",null,null,bn,"1111 1001"),new l("STD",null,null,vn,"1111 1101"),new l("STI",null,null,Dn,"1111 1011"),new l("NOP",null,null,yn,"1001 0000")],Rn=(s,e,t)=>Rs.find(r=>r.mnemonic===s.toUpperCase()&&(!r.op1||!e||r.op1.isValid(e))&&(!r.op2||!t||r.op2.isValid(t)));var Ye=["AL","AH","AX","BL","BH","BX","CL","CH","CX","DL","DH","DX","DI","SI","BP","SP","DS","ES","SS","CS","IP"];var oe=class{constructor(e){this.token=e;this.type=this.constructor.name}getSegment(e){return e.segments.find(t=>e.hasNode(t,this))?.location||e.registers.CS.value*16}},ye=class extends oe{constructor(e,t){super(e);this.size=t}getUnsigned(e){return new(this.size===1?Uint8Array:Uint16Array)([this.getValue(e)])[0]}getSigned(e){let t=new DataView(new(this.size===1?Uint8Array:Uint16Array)([this.getValue(e)]).buffer);return this.size===1?t.getInt8(0):t.getInt16(0,!0)}},B=class extends ye{constructor(e){let t,r;if(e.type===2&&e.lexeme.length<=2)t=e.lexeme.charCodeAt(0),r=1,e.lexeme.length===2&&(t<<=8,t+=e.lexeme.charCodeAt(1),r=2);else{let i=de(e.lexeme);if(!i)throw new Ht(e);t=i.value,r=i.size}super(e,r);this.value=new Uint16Array(1),this.value[0]=t}getValue(e){return this.value[0]}setValue(e,t){this.value[0]=t}},_=class extends ye{constructor(e){let t=Ye.find(r=>r===e.lexeme.toUpperCase());if(!t)throw new $t(e);super(e,/L|H$/i.test(e.lexeme)?1:2);this.register=t}getValue(e){return e.registers[this.register].value}setValue(e,t){e.registers[this.register].value=t}},E=class extends ye{constructor(e,t,r,i,o=!0,a=0,u=null){super(e,a);this.bpbx=t;this.sidi=r;this.imm=i;this.imm_sign=o;this.size=a;this.base=u}getValue(e){return e.memory.get(this.getAddress(e),this.size)}setValue(e,t){let r=this.getAddress(e);e.memory.set(r,t,this.size)}getAddress(e){let t;return this.base?t=e.dataLabels.find(i=>i.name===this.base)?.location??e.registers[this.base.toUpperCase()]?.value*16??e.registers.DS.value*16:t=e.registers.DS.value*16,t+(this.bpbx?this.bpbx.getValue(e):0)+(this.sidi?this.sidi.getValue(e):0)+(this.imm?this.imm.getValue(e)*(this.imm_sign?1:-1):0)}},kt=class extends B{constructor(e){super(new P(0,"0",new me));this.valueGetter=e}getValue(e){return this.valueGetter(e)}},x=class extends E{constructor(e,t=0){if(e.type!==1)throw new Ce(e);super(e,null,null,null,!0,t);this.label=e.lexeme,this.imm=new kt(r=>this.getValue(r))}getValue(e){return this.getNode(e)instanceof we?super.getValue(e):this.getOffset(e)}getAddress(e){let t=this.getNode(e)?.location;return t||0}getDisp(e){let t=this.getNode(e);return t?.location?t.location-(t.getSegment(e)+e.registers.IP.value):0}getOffset(e){return this.getDisp(e)+e.registers.IP.value}getNode(e){return this.node||(this.node=e.dataLabels.find(t=>t.name===this.label)||e.labels.find(t=>t.name===this.label)||e.procs.find(t=>t.name===this.label)||e.segments.find(t=>t.name===this.label))}},ve=class extends ye{constructor(e,t,r){super(e,2);this.segment=t;this.offset=r}getValue(e){return this.segment.getUnsigned(e)*16+this.offset.getUnsigned(e)}setValue(e,t){}},K=class extends oe{constructor(e,t,r,i=!1){if(r instanceof B&&t?.size===2&&(r.size=2),!r&&t instanceof E&&t.size===0&&i&&(t.size=2),t&&r instanceof E&&r.size===0?r.size=t.size:r&&t instanceof E&&(!t.base||Ye.includes(t.base?.toUpperCase()))&&!(t instanceof x&&r instanceof B)&&t.size===0&&(t.size=r.size),t&&r&&t.size!==0&&r.size!==0&&t.size<r.size)throw new Error("Size mismatch between operands");t instanceof E&&t.size===0&&["JMP","CALL","POP","PUSH"].includes(e.lexeme)&&(t.size=2);let o=Rn(i?`${e.lexeme} FAR PTR`:e.lexeme,t,r);if(!o)throw new ke(e,t?.token,r?.token);super(e);this.op1=t;this.op2=r;this.farptr=i;this.instruction=o}execute(e){this.instruction.executor.call(this,e)}getUnsigned(e){return[this.op1?.getUnsigned(e),this.op2?.getUnsigned(e)]}getSigned(e){return[this.op1?.getSigned(e),this.op2?.getSigned(e)]}size(e){let t=this.instruction.getBinary(e,this);return Math.ceil(t.length/8)}},et=class extends oe{constructor(e){if(e.type!==1)throw new Ce(e);super(e);this.name=e.lexeme}get location(){return this.instrNode?.location}},tt=class extends oe{constructor(e,t,r,i){super(e);this.alignmentType=t;this.combineType=r;this.className=i;this.name=e.lexeme,this.nodes=[]}get location(){return this.nodes.find(e=>e.location).location}},Ct=class extends oe{constructor(e,t){super(e);this.size=t}},Bt=class extends Ct{constructor(e){let t=de(e.lexeme);if(!t)throw new Xt(e);super(e,t.size);this.value=t.value}writeToMemory(e,t,r=this.size){return e.memory.set(t,this.value,r),r}},Tt=class extends Ct{constructor(e){super(e,1);this.value=e.lexeme}writeToMemory(e,t,r=this.size){let i=this.value.split("");for(let o of i)e.memory.set(t,o.charCodeAt(0),r),t+=r;return i.length*r}},Nt=class extends Ct{constructor(e){super(e,1)}writeToMemory(e,t,r=this.size){return r}},we=class extends oe{constructor(e,t,r){super(e);this.size=t;this.values=r;this.name=e.lexeme}get totalSize(){let e=0;for(let t of this.values)t instanceof Tt?e+=t.value.length*this.size:e+=this.size;return e}},De=class extends oe{constructor(e,t){super(e);this.near=t;this.name=e.lexeme,this.nodes=[]}get location(){return this.nodes.find(e=>e.location).location}},st=class extends oe{constructor(e){super(e);this.label=e.lexeme}},rt=class extends oe{constructor(e,t,r,i,o){super(e);this.cs=t;this.ds=r;this.ss=i;this.es=o}},Oe=class extends K{constructor(e,t){super(new P(1,"iret",new me));this.cpu=e;this.index=t;this.segment=62464,this.offset=368+Math.floor(t/4)*10,this.location=this.segment*16+this.offset,this.executor=e.int[t];let r=this.instruction.getBinary(e,this),i=Math.ceil(r.length/8);e.memory.set(this.location,parseInt(r,2),i,!1),e.memory.set(t*4,this.offset,2,!1),e.memory.set(t*4+2,this.segment,2,!1)}execute(e){this.executor(e),super.execute(e)}};var An=s=>/[ \t]/.test(s),wn=s=>/\d/.test(s),As=s=>/[a-zA-Z0-9_]/.test(s);var ws=class{constructor(e){this.contents=e;this.index=0,this.pos=new me}next(){this.skipWhitespace();let e=this.peek();if(!e||e==="\0")return this.end();if(/[\r\n]/.test(this.peek()))return this.newline();if(wn(e)||e==="-")return this.number();if(As(e))return this.identifier();if(e==="'"||e==='"')return this.string();if(e===";")return this.comment();{let t;switch(e){case"(":t=4;break;case")":t=5;break;case"[":t=6;break;case"]":t=7;break;case",":t=8;break;case":":t=9;break;case"?":t=10;break;case"+":t=11;break;case"-":t=12;break;default:return this.unknown()}let r={...this.pos};return new P(t,this.get(),r)}}identifier(){let{start:e,pos:t}=this.state;for(;As(this.peek());)this.get();return new P(1,this.getSliceFrom(e),t)}number(){let{start:e,pos:t}=this.state;if(this.peek()==="0"&&(this.get(),this.peek().toLowerCase()==="b"))for(this.get();this.peek()==="0"||this.peek()==="1";)this.get();for(this.peek()==="-"&&this.get();/[0-9a-f]/i.test(this.peek());)this.get();this.peek().toLowerCase()==="h"&&this.get();let r=this.getSliceFrom(e);return r==="-"?new P(12,r,t):new P(0,this.getSliceFrom(e),t)}string(){let e=this.get(),{start:t,pos:r}=this.state,i="";for(;i==="\\"||(i=this.peek())!==e;)if(this.get()==="\0")throw new Kt(new P(2,this.getSliceFrom(t),r));let o=this.index;return this.get(),new P(2,this.getSliceFrom(t,o),r)}comment(){let{start:e,pos:t}=this.state;for(this.get();!/[\r\n\0]/.test(this.peek());)this.get();return new P(3,this.getSliceFrom(e),t)}end(){let{start:e,pos:t}=this.state;return this.get(),new P(13,this.getSliceFrom(e),t)}unknown(){let{start:e,pos:t}=this.state;return this.get(),new P(14,this.getSliceFrom(e),t)}newline(){let{start:e,pos:t}=this.state;for(;/[\r\n]/.test(this.peek());)this.get();return new P(15,this.getSliceFrom(e),t)}peek(){return this.contents.charAt(this.index)||"\0"}get(){let e=this.contents.charAt(this.index++);return e===`
`?(this.pos.line++,this.pos.column=1):this.pos.column++,e||"\0"}skipWhitespace(){for(;An(this.peek());)this.get()}getSliceFrom(e,t=this.index){return this.contents.slice(e,t)}get state(){return{start:this.index,pos:{...this.pos}}}};var nt=(i=>(i[i.BYTE=0]="BYTE",i[i.WORD=1]="WORD",i[i.PARA=2]="PARA",i[i.PAGE=3]="PAGE",i))(nt||{}),_t=(i=>(i[i.PUBLIC=0]="PUBLIC",i[i.COMMON=1]="COMMON",i[i.STACK=2]="STACK",i[i.AT=3]="AT",i))(_t||{});var xe=class{constructor(e,t=null){this.context=t;this.identifier=this.getTypeClassifier(1);this.comma=this.getTypeClassifier(8);this.colon=this.getTypeClassifier(9);this.lsquare=this.getTypeClassifier(6);this.rsquare=this.getTypeClassifier(7);this.plus=this.getTypeClassifier(11);this.minus=this.getTypeClassifier(12);this.string=this.getTypeClassifier(2);this.qmark=this.getTypeClassifier(10);this.newline=this.getTypeClassifier(15);this.instrOp1Op2Pattern=[[this.instruction],[this.memory,this.segoff,this.immediate,this.register,this.label],[this.comma],[this.memory,this.segoff,this.immediate,this.register,this.label]];this.instrOp1Pattern=[[this.instruction],[this.memory,this.segoff,this.immediate,this.register,this.label]];this.instrPattern=[[this.instruction]];this.labelPattern=[[this.identifier],[this.colon]];this.segmentStartPattern=[[this.identifier],[this.getRegexClassifier(/^SEGMENT$/i)],[this.segmentOptions]];this.segmentEndPattern=[[this.identifier],[this.getRegexClassifier(/^ENDS$/i)]];this.procedureStartPattern=[[this.identifier],[this.getRegexClassifier(/^PROC$/i)],[this.getRegexClassifier(/^(NEAR)|(FAR)$/i)]];this.procedureEndPattern=[[this.identifier],[this.getRegexClassifier(/^ENDP$/i)]];this.dataPattern=[[this.identifier],[this.dataSize],[this.data]];this.data2Pattern=[[this.dataSize],[this.data]];this.assumePattern=[[this.getRegexClassifier(/^ASSUME$/i)],[this.assume]];this.endPattern=[[this.getRegexClassifier(/^END$/i)],[this.identifier]];this.lexer=new ws(e),this.tokens=[],this.nodes=[]}parse(){this.tokens=[];let e;for(;(e=this.lexer.next()).type!==13;)this.tokens.push(e);this.tokens.push(new P(15,`
`,this.tokens[this.tokens.length-1].pos)),this.nodes=[];let t=null,r=null,i=null;for(let o=0;o<this.tokens.length;o++){if(this.tokens[o].type===14)throw new ee(this.tokens[o]);let a=null,u=null;if(u=this.matchPatternAt(o,this.segmentStartPattern)){let c=u[0][0],p=u[2],g=p.map(S=>S.type===1&&nt[S.lexeme.toUpperCase()]).find(S=>typeof S=="number"),f=p.map(S=>S.type===1&&_t[S.lexeme.toUpperCase()]).find(S=>typeof S=="number"),b=p.find(S=>S.type===2)?.lexeme;r=new tt(c,g,f,b)}else if(u=this.matchPatternAt(o,this.segmentEndPattern)){let c=u[0][0];if(!r)throw new ee(c);if(r.name!==c.lexeme)throw new Jt(c);this.nodes.push(r),r=null}else if(this.context==="watch"&&(u=this.matchPatternAt(o,[[this.memory,this.immediate,this.register,this.identifier]])))a=this.getOperand(o)??null,a&&a.size===0&&(a.size=1);else if(u=this.matchPatternAt(o,this.labelPattern))t=new et(u[0][0]);else if(u=this.matchPatternAt(o,this.procedureStartPattern))i=new De(u[0][0],/NEAR/i.test(u[2][0].lexeme));else if(u=this.matchPatternAt(o,this.procedureEndPattern)){let c=u[0][0];if(!i)throw new ee(c);if(i.name!==c.lexeme)throw new Qt(c);a=i,i=null}else if(u=this.matchPatternAt(o,this.endPattern))a=new st(u[1][0]);else if(u=this.matchPatternAt(o,this.assumePattern)){let c,p,g,f;for(let b=0;b<u[1].length;b+=4){let S=u[1][b].lexeme.toUpperCase(),L=u[1][b+2].lexeme;switch(S){case"CS":c=L;break;case"DS":p=L;break;case"SS":g=L;break;case"ES":f=L;break}}a=new rt(u[0][0],c,p,g,f)}else if((u=this.matchPatternAt(o,this.dataPattern))||(u=this.matchPatternAt(o,this.data2Pattern))){let c=(u.length===3?u[2]:u[1]).filter(g=>g.type!==8),p=[];for(let g=0;g<c.length;g++)if(g<c.length-4&&/^DUP$/i.test(c[g+1].lexeme)){let f=de(c[g].lexeme)?.value;for(let b=0;b<f;b++)p.push(c[g+3].type===10?new Nt(new P(10,c[g+3].lexeme,c[g].pos)):new Bt(new P(0,c[g+3].lexeme,c[g].pos)));g+=4}else p.push(c[g].type===0?new Bt(c[g]):c[g].type===2?new Tt(c[g]):new Nt(c[g]));a=new we(u.length===3?u[0][0]:new P(1,"",u[0][0].pos),z[(u.length===3?u[1][0]:u[0][0]).lexeme.toUpperCase()],p)}else if(u=this.matchPatternAt(o,this.instrOp1Op2Pattern)){let c=this.getOperand(o+u[0].length),p=this.getOperand(o+u[0].length+u[1].length+1);a=new K(u[0][0],c,p,u[0].length>1)}else(u=this.matchPatternAt(o,this.instrOp1Pattern))?a=new K(u[0][0],this.getOperand(o+u[0].length),void 0,u[0].length>1):(u=this.matchPatternAt(o,this.instrPattern))&&(a=new K(u[0][0]));if(t&&a){if(!(a instanceof K))throw new Ce(t.token);t.instrNode=a,a=t,t=null}a&&(i?i.nodes.push(a):r?r.nodes.push(a):this.nodes.push(a)),u&&(o+=u.reduce((c,p)=>c+p.length,0),o--)}if(r)throw new Yt(r.token);if(i)throw new es(i.token);return this.nodes}immediate(e){let t=this.tokens[e];return t.type===0&&de(t.lexeme)||t.type===2&&t.lexeme.length<=2?[t]:null}register(e){let t=this.tokens[e];return t.type===1&&Ye.find(r=>r===t.lexeme.toUpperCase())?[t]:null}label(e){let t=this.tokens[e];return e<this.tokens.length-1&&/^OFFSET$/i.test(t.lexeme)&&this.identifier(e+1)?[t,this.tokens[e+1]]:this.identifier(e)?[t]:null}memory(e){let t=e;if(e<this.tokens.length-1&&/^(WORD|BYTE) PTR$/i.test(`${this.tokens[e].lexeme} ${this.tokens[e+1].lexeme}`)&&(t+=2),t<this.tokens.length&&this.identifier(t)&&(t+=1,t<this.tokens.length&&this.colon(t)&&(t+=1)),this.tokens[t].type!==6)return null;let r=e;for(;r<this.tokens.length&&!this.isLineEnd(this.tokens[r])&&this.tokens[r].type!==7;)r++;if(this.tokens[r].type!==7)throw new Zt(this.tokens[e]);let i=!1,o=!1,a=!1,u=!1,c=[];for(let p=e;p<=t;p++)c.push(this.tokens[p]);for(let p=t+1;p<r;p++){let g=this.tokens[p].lexeme,f=de(g);if(!u&&!i&&this.register(p)&&/BP|BX/i.test(g))i=!0,u=!0;else if(!u&&!o&&this.register(p)&&/SI|DI/i.test(g))o=!0,u=!0;else if(!u&&!a&&this.immediate(p)&&f&&f.size<=2)a=!0,u=!0;else if(this.plus(p)||this.minus(p))if(u)u=!1;else throw new ee(this.tokens[p]);else throw new ee(this.tokens[p]);c.push(this.tokens[p])}return c.push(this.tokens[r]),c}segoff(e){return e<this.tokens.length-2&&this.tokens[e].type===0&&this.tokens[e+1].type===9&&this.tokens[e+2].type===0?[this.tokens[e],this.tokens[e+1],this.tokens[e+2]]:null}instruction(e){let t=this.tokens[e];return e<this.tokens.length-2&&t.type===1&&/^FAR PTR$/i.test(`${this.tokens[e+1].lexeme} ${this.tokens[e+2].lexeme}`)?[t,this.tokens[e+1],this.tokens[e+2]]:t.type===1?[t]:null}alignmentType(e){let t=this.tokens[e];return t.type===1&&Object.values(nt).includes(t.lexeme.toUpperCase())?[t]:null}combineType(e){let t=this.tokens[e];return t.type===1&&Object.values(_t).includes(t.lexeme.toUpperCase())?[t]:null}segmentOptions(e){let t=[this.alignmentType,this.combineType,this.string],r;for(r=e;r<e+3&&r<this.tokens.length&&!this.isLineEnd(this.tokens[r]);r++){let i=t.findIndex(o=>o.call(this,r)!==null);if(i===-1)return null;t=[...t.slice(0,i),...t.slice(i+1,t.length)]}return this.tokens.slice(e,r)}dup(e){return e+4<this.tokens.length&&this.tokens[e].type===0&&/^DUP$/i.test(this.tokens[e+1].lexeme)&&this.tokens[e+2].type===4&&(this.tokens[e+3].type===0||this.tokens[e+3].type===10)&&this.tokens[e+4].type===5?this.tokens.slice(e,e+5):null}data(e){let t=[this.dup,this.immediate,this.string,this.qmark],r=[],i=!1,o;for(o=e;o<this.tokens.length&&!this.isLineEnd(this.tokens[o]);o++)if(i)if(this.tokens[o].type===8)i=!1,r.push(this.tokens[o]);else throw new ee(this.tokens[o]);else{if(this.tokens[o].type===8)throw new ee(this.tokens[o]);let a=null;for(let u of t)if(a=u.call(this,o),a)break;if(a)i=!0,r=r.concat(a),o+=a.length-1;else throw new ee(this.tokens[o])}return r}dataSize(e){let t=this.tokens[e];return t.type===1&&Object.keys(z).includes(t.lexeme.toUpperCase())?[t]:null}assume(e){let t=[];for(let r=e;r<this.tokens.length&&!this.isLineEnd(this.tokens[r]);r+=3){let i=this.tokens[r],o=this.tokens[r+2];if(!["CS","DS","ES","SS"].includes(i.lexeme.toString().toUpperCase())||o.type!==1)throw new ee(i);t.push(this.tokens[r],this.tokens[r+1],this.tokens[r+2]),this.tokens[r+3].type===8&&(t.push(this.tokens[r+3]),r++)}return t}getTypeClassifier(e){return t=>this.tokens[t].type===e?[this.tokens[t]]:null}getRegexClassifier(e){return t=>this.tokens[t].type===1&&e.test(this.tokens[t].lexeme)?[this.tokens[t]]:null}matchPatternAt(e,t){let r=0,i=[];for(let o=0;o<t.length;o++){if(e+r>=this.tokens.length)return null;let u=t[o].map(c=>c.call(this,e+r)).find(Boolean);if(!u)return null;i.push(u),r+=u.length}return i}getOperand(e){let t;if(t=this.memory(e)){let r=0,i=1;/^WORD PTR$/i.test(`${this.tokens[e].lexeme} ${this.tokens[e+1].lexeme}`)?(r=2,i+=2):/^BYTE PTR$/i.test(`${this.tokens[e].lexeme} ${this.tokens[e+1].lexeme}`)&&(r=1,i+=2);let o=null;this.identifier(e+i-1)&&(o=t[i-1].lexeme,i+=1,i<t.length&&this.colon(e+i-1)&&(i+=1));let a=!0,u=null,c=null,p=null,g=!0;for(let f of t.slice(i,t.length-1))f.type===11?a=!0:f.type===12?a=!1:f.type===0?(p=new B(f),g=a):/BP|BX/i.test(f.lexeme)?u=new _(f):c=new _(f);return new E(this.tokens[e],u,c,p,g,r,o)}if(this.segoff(e))return new ve(this.tokens[e],new B(this.tokens[e]),new B(this.tokens[e+2]));if(this.immediate(e))return new B(this.tokens[e]);if(this.register(e))return new _(this.tokens[e]);if(this.label(e))return/^OFFSET$/i.test(this.tokens[e].lexeme)?new kt(r=>new x(this.tokens[e+1]).getOffset(r)):new x(this.tokens[e])}isLineEnd(e){return e.type===15||e.type===13}};var Sn=ce(xn());var it=class{constructor(){this.changes=new Set;this.data=new Uint8Array(it.SIZE),this.view=new DataView(this.data.buffer)}set(e,t,r=1,i=!0){if(e<0||e>=it.SIZE)throw Error(`Memory address has to be a positive integer less than ${it.SIZE}, given ${e}`);switch(r){case 1:this.view.setUint8(e,t),i&&this.changes.add(e);break;case 2:this.view.setUint16(e,t,!0),i&&(this.changes.add(e),this.changes.add(e+1));break;case 4:this.view.setUint32(e,t,!0),i&&(this.changes.add(e),this.changes.add(e+1),this.changes.add(e+2),this.changes.add(e+3));break;case 8:this.view.setBigUint64(e,BigInt(t),!0),i&&(this.changes.add(e),this.changes.add(e+1),this.changes.add(e+2),this.changes.add(e+3),this.changes.add(e+4),this.changes.add(e+5),this.changes.add(e+6),this.changes.add(e+7));break}}get(e,t){switch(t){case 1:return this.view.getUint8(e);case 2:return this.view.getUint16(e,!0);case 4:return this.view.getUint32(e,!0);case 8:return Number(this.view.getBigUint64(e,!0));default:return 0}}toString(e){return(0,Sn.hexy)(Buffer.from(this.data),{offset:e,format:"twos",width:16,length:16*5})}},Ft=it;Ft.SIZE=1e6;var N=class{constructor(e){this.name=e;this._value=new Uint8Array(2),this.view=new DataView(this._value.buffer)}set value(e){this.view.setUint16(0,e,!0)}get value(){return this.view.getUint16(0,!0)}get signed(){return this.view.getInt16(0,!0)}},ae=class extends N{constructor(e,t){super(e);this.parent=t;this.isLow=/L$/i.test(e)}set value(e){this.parent.view.setUint8(this.isLow?0:1,e)}get value(){return this.parent.view.getUint8(this.isLow?0:1)}get signed(){return this.parent.view.getInt8(this.isLow?0:1)}};var ot=class extends N{get carry(){return this.getBit(0)}set carry(e){this.setBit(0,e)}get parity(){return this.getBit(2)}set parity(e){this.setBit(2,e)}get auxilliary(){return this.getBit(4)}set auxilliary(e){this.setBit(4,e)}get zero(){return this.getBit(6)}set zero(e){this.setBit(6,e)}get sign(){return this.getBit(7)}set sign(e){this.setBit(7,e)}get trap(){return this.getBit(8)}set trap(e){this.setBit(8,e)}get interrupt(){return this.getBit(9)}set interrupt(e){this.setBit(9,e)}get directional(){return this.getBit(10)}set directional(e){this.setBit(10,e)}get overflow(){return this.getBit(11)}set overflow(e){this.setBit(11,e)}getBit(e){return this.value&this.bitmask(e)?1:0}setBit(e,t){t?this.value|=this.bitmask(e):this.value&=~this.bitmask(e)}bitmask(e){return 1<<e}};var Ut=class{constructor(){this.nodes=[];this.labels=[];this.instructions=[];this.dataLabels=[];this.procs=[];this.segments=[];this.startLabel=null;this.assume={};this.outBuffer=[];this.inBuffer=[];this.int=[];this.input=!1;let e=new N("AX"),t=new N("BX"),r=new N("CX"),i=new N("DX");this.registers={AX:e,AL:new ae("AL",e),AH:new ae("AH",e),BX:t,BL:new ae("BL",t),BH:new ae("BH",t),CX:r,CL:new ae("CL",r),CH:new ae("CH",r),DX:i,DL:new ae("DL",i),DH:new ae("DH",i),DI:new N("DI"),SI:new N("SI"),BP:new N("BP"),SP:new N("SP"),DS:new N("DS"),ES:new N("ES"),SS:new N("SS"),CS:new N("CS"),IP:new N("IP"),FLAG:new ot("FLAG")},this.memory=new Ft,this.registers.CS.value=1024,this.registers.SS.value=1024,this.registers.DS.value=1024,this.registers.SP.value=65535}load(e){this.source=e;let t=new xe(e);this.nodes=t.parse(),this.labels=[],this.instructions=[],this.dataLabels=[],this.procs=[],this.segments=[],this.outBuffer=[],this.inBuffer=[],this.int=[],this.input=!1;for(let r of this.nodes)this.preprocess(r);for(let[r,i]of Object.entries(this.assume)){if(!i)continue;let o=this.segments.find(a=>a.name===i);if(o?.location)this.registers[r].value=o.location>>4;else throw new Error("Assumed segment does not exist")}if(this.push(65535),this.startLabel){let r=this.labels.find(i=>i.name===this.startLabel)||this.procs.find(i=>i.name===this.startLabel);r?.location?this.registers.IP.value=r.location-this.registers.CS.value*16||0:this.registers.IP.value=0}else this.registers.IP.value=0;this.int[0]=r=>{r.outBuffer.push("DIVIDE ERROR INTERRUPT")},this.int[4]=r=>{r.outBuffer.push("OVERFLOW INTERRUPT")},this.int[33]=r=>{switch(r.registers.AH.value){case 1:this.input=!0;break;case 2:this.outBuffer.push(String.fromCharCode(this.registers.DL.value));break}};for(let r in this.int)this.instructions.push(new Oe(this,Number(r)))}preprocess(e){let t=this.registers.CS.value*16+this.registers.IP.value;if(e instanceof K){let r=e.instruction.getBinary(this,e),i=Math.ceil(r.length/8);e.location=t,this.memory.set(t,parseInt(r,2),i),this.registers.IP.value+=i;let o=e.op1 instanceof x?e.op1:e.op2;if(o instanceof x&&o.size===0){let u=o.getNode(this);o.size=u instanceof we?u.size:2}let a=e.op1 instanceof E?e.op1:e.op2;if(a instanceof E&&a.base){let u=this.dataLabels.find(c=>c.name===a.base);u&&(a.size=u.size)}if(e.op2 instanceof B&&e.op1?.size===2&&(e.op2.size=2),e.op1&&e.op2&&e.op1.size<e.op2.size)throw new Error("Size mismatch between operands");if(e.op1&&!(e.op1 instanceof x)&&e.op1.size===0||e.op2&&!(e.op2 instanceof x)&&e.op2.size===0)throw new Error("Unknown operand size");this.instructions.push(e)}else if(e instanceof et)this.labels.push(e),this.preprocess(e.instrNode);else if(e instanceof we){e.location=t;for(let r of e.values)this.registers.IP.value+=r.writeToMemory(this,this.registers.CS.value*16+this.registers.IP.value,e.size);this.dataLabels.push(e)}else if(e instanceof tt){let r=0;e.alignmentType===1&&t%2!==0?r=1:e.alignmentType===2&&t%16!==0?r=Math.ceil(t/16)*16-t:e.alignmentType===3&&t%256!==0&&(r=Math.ceil(t/256)*256-t),this.registers.IP.value+=r,this.segments.push(e),e.nodes.forEach(i=>this.preprocess(i))}else e instanceof De?(this.procs.push(e),e.nodes.forEach(r=>this.preprocess(r))):e instanceof st?this.startLabel=e.label:e instanceof rt&&(this.assume.CS=e.cs,this.assume.DS=e.ds,this.assume.SS=e.ss,this.assume.ES=e.es)}hasNode(e,t){return e.token.id===t.token.id?!0:e.nodes?e.nodes.reduce((r,i)=>r||this.hasNode(i,t),!1):!1}get currentNode(){let e=this.registers.CS.value*16+this.registers.IP.value,t=this.instructions.find(r=>r.location===e)||this.dataLabels.find(r=>r.location===e);return t instanceof Oe||(this.prevNode=t),t}step(){if(this.input)return;let e=this.currentNode;!e||(e instanceof K?(e.execute(this),this.registers.IP.value+=e.size(this)):this.registers.IP.value+=e.totalSize)}run(){for(;this.registers.IP.value<this.instructions.length;)this.step()}push(e){this.memory.set(this.registers.SS.value*16+this.registers.SP.value,e,2),this.registers.SP.value-=2}pop(){return this.registers.SP.value+=2,this.memory.get(this.registers.SS.value*16+this.registers.SP.value,2)}};var In=ce(require("vscode")),C=class{constructor(e,t){this.name=e;this._value=t}get value(){return this._value}set value(e){this._value=e,this._memory=void 0}get memory(){return this._memory===void 0&&typeof this._value=="string"&&(this._memory=new TextEncoder().encode(this._value)),this._memory}setMemory(e,t=0){let r=this.memory;!r||(r.set(e,t),this._memory=r,this._value=new TextDecoder().decode(r))}};var xs=class extends En.EventEmitter{constructor(e){super();this.fileAccessor=e;this.cpu=new Ut;this._sourceFile="";this.variables=new Map;this.sourceLines=[];this.instructions=[];this.starts=[];this.ends=[];this._currentLine=0;this.instruction=0;this.breakPoints=new Map;this.instructionBreakpoints=new Set;this.breakpointId=1;this.breakAddresses=new Map;this.otherExceptions=!1;this.ended=!1;this.loaded=!1;this.lastStop=0;this.lastLines=[];this.loopThreshold=100}get sourceFile(){return this._sourceFile}get currentLine(){let e=this.cpu.currentNode;return e instanceof Oe?this.cpu.prevNode?.token.pos.line||this.sourceLines.length-1:e?e.token.pos.line:this.sourceLines.length-1}set currentLine(e){}async start(e,t,r){this.loaded=!1,await this.loadSource(this.normalizePathAndCasing(e)),!this.ended&&(r?(await this.verifyBreakpoints(this._sourceFile),t?(this.sendEvent("stopOnEntry"),this.sendEvent("output","console",`.m <memory address> (ex: .m [5] | .m cs:[5] | .m arr[5] | .m [bx + si + 5])
.i <instruction (ex: .i mov ax, 5)
`,this._sourceFile,1,1)):await this.continue()):await this.continue())}async continue(){if(this.ended){this.sendEvent("end");return}let e=null;for(;this.cpu.currentNode;){let t=this.breakPoints.get(this.normalizePathAndCasing(this._sourceFile));if(t){let r=t.filter(i=>i.line===this.currentLine&&i.id!==this.lastBreakpoint?.id);if(r.length>0){this.sendEvent("stopOnBreakpoint"),r[0].verified||(r[0].verified=!0,this.sendEvent("breakpointValidated",r[0])),e=r[0];break}}if(!await this.cpuStep(!0))return;this.reachedEOF()}e?this.lastBreakpoint=e:this.sendEvent("stopOnStep")}async step(){if(this.ended){this.sendEvent("end");return}!await this.cpuStep()||(this.reachedEOF(),this.sendEvent("stopOnStep"))}async cpuStep(e=!1){try{this.cpu.step();let t=this.cpu.currentNode,r=t?.token.pos.line||this.currentLine,i=t?.token.pos.column||1;for(;this.cpu.outBuffer.length>0;)this.cpu.outBuffer[0].length===1&&(this.cpu.registers.AL.value=this.cpu.outBuffer[0].charCodeAt(0)),this.sendEvent("output","out",this.cpu.outBuffer.shift(),this._sourceFile,r,i);if(this.cpu.input){if(this.cpu.inBuffer.length===0){let o=await In.window.showInputBox({placeHolder:"Input",prompt:"Program asked for input",ignoreFocusOut:!0});if(!o&&e)return this.sendEvent("stopOnStep"),!1;o?o+="\r":o="\0";let a=o.split("");for(let u of a)this.cpu.inBuffer.push(u)}this.cpu.inBuffer.length!==0&&(this.cpu.registers.AL.value=this.cpu.inBuffer.shift().charCodeAt(0)),this.cpu.input=!1}}catch(t){let r=t,i=r.token?.pos.line||this.currentLine,o=r.token?.pos.column||1;return this.sendEvent("output","err",`Error at line ${i} column ${o}: ${r.message}
`,this._sourceFile,i,o),this.sendEvent("end"),this.ended=!0,console.error(r),!1}return!0}reachedEOF(){this.cpu.currentNode||(this.ended=!0)}stack(e,t){let r=this.getLine(),i=this.getWords(this.currentLine,r);i.push({name:"BOTTOM",line:-1,index:-1});let o=[];for(let a=e;a<Math.min(t,this.sourceLines.length);a++){let u={index:a,name:`${this.sourceLines[a]}(${a})`,file:this._sourceFile,line:this.currentLine,column:1};o.push(u)}return{frames:o,count:i.length}}getBreakpoints(e,t){return[1]}async setBreakPoint(e,t){e=this.normalizePathAndCasing(e);let r={verified:!1,line:t,id:this.breakpointId++},i=this.breakPoints.get(e);return i||(i=new Array,this.breakPoints.set(e,i)),i.push(r),await this.verifyBreakpoints(e),r}clearBreakPoint(e,t){let r=this.breakPoints.get(this.normalizePathAndCasing(e));if(r){let i=r.findIndex(o=>o.line===t);if(i>=0){let o=r[i];return r.splice(i,1),o}}}clearBreakpoints(e){this.breakPoints.delete(this.normalizePathAndCasing(e))}getLine(e){return this.sourceLines[e===void 0?this.currentLine:e].trim()}getWords(e,t){let r=/[a-z]+/gi,i=[],o;for(;o=r.exec(t);)i.push({name:o[0],line:e,index:o.index});return i}async loadSource(e){this._sourceFile!==e&&(this._sourceFile=this.normalizePathAndCasing(e),this.initializeContents(await this.fileAccessor.readFile(e)))}initializeContents(e){let t=new TextDecoder().decode(e);try{t+=`
`,this.loaded||(this.cpu=new Ut,this.cpu.load(t),this.loaded=!0)}catch(r){let i=r,o=i.token?.pos.line||this.currentLine,a=i.token?.pos.column||1;this.sendEvent("output","err",`Error at line ${o} column ${a}: ${i.message}
`,this._sourceFile,o,a),this.sendEvent("end"),this.ended=!0,console.error(i);return}this.sourceLines=t.split(/\r?\n/),this.instructions=[],this.starts=[],this.instructions=[],this.ends=[];for(let r=0;r<this.sourceLines.length;r++){this.starts.push(this.instructions.length);let i=this.getWords(r,this.sourceLines[r]);for(let o of i)this.instructions.push(o);this.ends.push(this.instructions.length)}}async verifyBreakpoints(e){let t=this.breakPoints.get(e);t&&(await this.loadSource(e),t.forEach(r=>{if(!r.verified&&r.line<this.sourceLines.length){let i=[...this.cpu.instructions];i.sort((a,u)=>a.token.pos.line-u.token.pos.line);let o=i.find(a=>a.token.pos.line>=r.line);o&&(r.verified=!0,r.line!==o.token.pos.line?(r.line=o.token.pos.line,this.sendEvent("breakpointChanged","changed",r)):this.sendEvent("breakpointValidated",r))}}))}sendEvent(e,...t){setTimeout(()=>{this.emit(e,...t)},0)}normalizePathAndCasing(e){return this.fileAccessor.isWindows?e.replace(/\//g,"\\").toLowerCase():e.replace(/\\/g,"/").toLowerCase()}};var Nn=ce(Ln()),Wt=ce(Bn());var se=class extends v.LoggingDebugSession{constructor(e){super("mock-debug.txt");this._variableHandles=new v.Handles;this._configurationDone=new Nn.Subject;this._cancellationTokens=new Map;this._reportProgress=!1;this._progressId=1e4;this._cancelledProgressId=void 0;this._isProgressCancellable=!0;this._valuesInHex=!1;this._useInvalidatedEvent=!1;this._addressesInHex=!0;this.setDebuggerLinesStartAt1(!0),this.setDebuggerColumnsStartAt1(!0),this._runtime=new xs(e),this._runtime.on("stopOnEntry",()=>{this.sendEvent(new v.StoppedEvent("entry",se.threadID))}),this._runtime.on("stopOnStep",()=>{this.sendEvent(new v.StoppedEvent("step",se.threadID))}),this._runtime.on("stopOnBreakpoint",()=>{this.sendEvent(new v.StoppedEvent("breakpoint",se.threadID))}),this._runtime.on("breakpointChanged",(t,r)=>{this.sendEvent(new v.BreakpointEvent(t,r))}),this._runtime.on("stopOnDataBreakpoint",()=>{this.sendEvent(new v.StoppedEvent("data breakpoint",se.threadID))}),this._runtime.on("stopOnInstructionBreakpoint",()=>{this.sendEvent(new v.StoppedEvent("instruction breakpoint",se.threadID))}),this._runtime.on("stopOnException",t=>{t?this.sendEvent(new v.StoppedEvent(`exception(${t})`,se.threadID)):this.sendEvent(new v.StoppedEvent("exception",se.threadID))}),this._runtime.on("breakpointValidated",t=>{this.sendEvent(new v.BreakpointEvent("changed",{verified:t.verified,id:t.id}))}),this._runtime.on("output",(t,r,i,o,a)=>{let u;switch(t){case"prio":u="important";break;case"out":u="stdout";break;case"err":u="stderr";break;default:u="console";break}let c=new v.OutputEvent(`${r}`,u);(r==="start"||r==="startCollapsed"||r==="end")&&(c.body.group=r,c.body.output=`group-${r}
`),c.body.source=this.createSource(i),c.body.line=this.convertDebuggerLineToClient(o),c.body.column=this.convertDebuggerColumnToClient(a),this.sendEvent(c)}),this._runtime.on("end",()=>{this.sendEvent(new v.TerminatedEvent)})}initializeRequest(e,t){t.supportsProgressReporting&&(this._reportProgress=!0),t.supportsInvalidatedEvent&&(this._useInvalidatedEvent=!0),e.body=e.body||{},e.body.supportsConfigurationDoneRequest=!0,e.body.supportsEvaluateForHovers=!0,e.body.supportsStepBack=!1,e.body.supportsDataBreakpoints=!1,e.body.supportsCompletionsRequest=!0,e.body.supportsCancelRequest=!0,e.body.supportsBreakpointLocationsRequest=!0,e.body.supportsStepInTargetsRequest=!1,e.body.supportsExceptionFilterOptions=!1,e.body.supportsExceptionInfoRequest=!1,e.body.supportsSetVariable=!0,e.body.supportsSetExpression=!0,e.body.supportsDisassembleRequest=!1,e.body.supportsSteppingGranularity=!1,e.body.supportsInstructionBreakpoints=!1,e.body.supportsReadMemoryRequest=!0,e.body.supportsWriteMemoryRequest=!0,e.body.supportSuspendDebuggee=!0,e.body.supportTerminateDebuggee=!0,e.body.supportsFunctionBreakpoints=!1,e.body.supportsDelayedStackTraceLoading=!1,this.sendResponse(e),this.sendEvent(new v.InitializedEvent)}configurationDoneRequest(e,t){super.configurationDoneRequest(e,t),this._configurationDone.notify()}disconnectRequest(e,t,r){console.log(`disconnectRequest suspend: ${t.suspendDebuggee}, terminate: ${t.terminateDebuggee}`)}async attachRequest(e,t){return this.launchRequest(e,t)}async launchRequest(e,t){v.logger.setup(t.trace?v.Logger.LogLevel.Verbose:v.Logger.LogLevel.Stop,!1),await this._configurationDone.wait(1e3),await this._runtime.start(t.program,!!t.stopOnEntry,!t.noDebug),t.compileError?this.sendErrorResponse(e,{id:1001,format:"compile error: some fake error.",showUser:t.compileError==="show"?!0:t.compileError==="hide"?!1:void 0}):this.sendResponse(e)}async setBreakPointsRequest(e,t){let r=t.source.path,i=t.lines||[];this._runtime.clearBreakpoints(r);let o=i.map(async u=>{let{verified:c,line:p,id:g}=await this._runtime.setBreakPoint(this._runtime.normalizePathAndCasing(r),this.convertClientLineToDebugger(u)),f=new v.Breakpoint(c,this.convertDebuggerLineToClient(p));return f.id=g,f}),a=await Promise.all(o);e.body={breakpoints:a},this.sendResponse(e)}breakpointLocationsRequest(e,t,r){if(t.source.path){let i=this._runtime.getBreakpoints(t.source.path,this.convertClientLineToDebugger(t.line));e.body={breakpoints:i.map(o=>({line:t.line,column:this.convertDebuggerColumnToClient(o)}))}}else e.body={breakpoints:[]};this.sendResponse(e)}threadsRequest(e){e.body={threads:[new v.Thread(se.threadID,"thread 1"),new v.Thread(se.threadID+1,"thread 2")]},this.sendResponse(e)}stackTraceRequest(e,t){let r=typeof t.startFrame=="number"?t.startFrame:0,i=typeof t.levels=="number"?t.levels:1e3,o=r+i,a=this._runtime.stack(r,o);e.body={stackFrames:a.frames.map((u,c)=>{let p=new v.StackFrame(u.index,u.name,this.createSource(u.file),this.convertDebuggerLineToClient(u.line));if(typeof u.column=="number"&&(p.column=this.convertDebuggerColumnToClient(u.column)),typeof u.instruction=="number"){let g=this.formatAddress(u.instruction);p.name=`${u.name} ${g}`,p.instructionPointerReference=g}return p}),totalFrames:a.count},this.sendResponse(e)}scopesRequest(e,t){e.body={scopes:[new v.Scope("Registers",this._variableHandles.create("registers"),!1),new v.Scope("Data",this._variableHandles.create("data"),!1),new v.Scope("Memory",this._variableHandles.create("memory"),!0)]},this.sendResponse(e)}async writeMemoryRequest(e,{data:t,memoryReference:r,offset:i=0}){let o=this._variableHandles.get(Number(r));if(typeof o=="object"){let a=Wt.toByteArray(t);o.setMemory(a,i),e.body={bytesWritten:a.length}}else e.body={bytesWritten:0};this.sendResponse(e),this.sendEvent(new v.InvalidatedEvent(["variables"]))}async readMemoryRequest(e,{offset:t=0,count:r,memoryReference:i}){let o=this._variableHandles.get(Number(i));if(typeof o=="object"&&o.memory){let a=o.memory.subarray(Math.min(t,o.memory.length),Math.min(t+r,o.memory.length));e.body={address:t.toString(),data:Wt.fromByteArray(a),unreadableBytes:r-a.length}}else e.body={address:t.toString(),data:"",unreadableBytes:r};this.sendResponse(e)}async variablesRequest(e,t,r){let i=[],o=this._variableHandles.get(t.variablesReference);if(o==="registers"){if(i=Object.values(this._runtime.cpu.registers).map(a=>new C(a.name,a instanceof ot?[new C("C",a.carry?1:0),new C("P",a.parity?1:0),new C("A",a.auxilliary?1:0),new C("Z",a.zero?1:0),new C("S",a.sign?1:0),new C("T",a.trap?1:0),new C("I",a.interrupt?1:0),new C("D",a.directional?1:0),new C("O",a.overflow?1:0)]:a.value)),this._valuesInHex)for(let a of i)if(typeof a.value=="object")for(let u of a.value)u.value=u.value.toString(16);else a.value=a.value.toString(16)}else if(o==="data")i=Object.values(this._runtime.cpu.dataLabels).filter(a=>a.location).map(a=>{let u=[];for(let p=0;p<a.totalSize;p+=a.size)u.push(this._runtime.cpu.memory.get(a.location+p,a.size));let c=u.map((p,g)=>new C(g.toString(this._valuesInHex?16:10),p));return new C(a.name,a.values.length===1?u[0]:c)});else if(o==="memory"){if(i=[...this._runtime.cpu.memory.changes].map(a=>new C(a.toString(),this._runtime.cpu.memory.get(a,1))),i.sort((a,u)=>a.name.localeCompare(u.name)),this._valuesInHex)for(let a of i)a.value=a.value.toString(16)}else o&&Array.isArray(o.value)&&(i=o.value);e.body={variables:i.map(a=>this.convertFromRuntime(a))},this.sendResponse(e)}setVariableRequest(e,t){let r=this._variableHandles.get(t.variablesReference),i;if(r==="registers"){i=new C(t.name,0);let a=de(t.value);a&&(i.value=a.value,this._runtime.cpu.registers[t.name].value=a.value)}r==="data"&&(i=new C(t.name,0),i.value=t.value,this._runtime.cpu.dataLabels.find(a=>a.name===t.name).values[0].value=parseInt(t.value)),r==="memory"&&(i=new C(t.name,0),i.value=t.value,this._runtime.cpu.memory.set(parseInt(t.name),i.value,1));let o=i||(r instanceof C&&r.value instanceof Array?r.value.find(a=>a.name===t.name):void 0);o&&(o.value=this.convertToRuntime(t.value),e.body=this.convertFromRuntime(o),o.memory&&o.reference&&this.sendEvent(new v.MemoryEvent(String(o.reference),0,o.memory.length))),this.sendResponse(e)}async continueRequest(e,t){await this._runtime.continue(),this.sendResponse(e)}async nextRequest(e,t){await this._runtime.step(),this.sendResponse(e)}stepBackRequest(e,t){}stepInTargetsRequest(e,t){}async stepInRequest(e,t){await this._runtime.step(),this.sendResponse(e)}stepOutRequest(e,t){}async evaluateRequest(e,t){let r="",i=t.expression.startsWith(".m"),o=t.expression.startsWith(".i");try{if(t.context==="repl"&&i){let a=new xe(t.expression.slice(2),"watch").parse();if(a.length>0&&a[0]instanceof ye){let u=a[0]instanceof E?a[0].getAddress(this._runtime.cpu):a[0].getUnsigned(this._runtime.cpu);r=this._runtime.cpu.memory.toString(u)}else r="Invalid command"}else if(t.context==="repl"&&o){let a=new xe(t.expression.slice(2)).parse();a.length===0?r="Invalid command":a[0]instanceof K&&a[0].execute(this._runtime.cpu)}else{let a=new xe(t.expression,"watch").parse();a.length===0?r="Invalid command":a[0]instanceof ye?r=a[0].getValue(this._runtime.cpu).toString():r="Invalid command"}}catch(a){r=a.message}e.body={result:r,variablesReference:0},this.sendResponse(e)}completionsRequest(e,t){e.body={targets:Rs.map(r=>({label:r.mnemonic}))},this.sendResponse(e)}cancelRequest(e,t){t.requestId&&this._cancellationTokens.set(t.requestId,!0),t.progressId&&(this._cancelledProgressId=t.progressId)}customRequest(e,t,r){e==="toggleFormatting"?(this._valuesInHex=!this._valuesInHex,this._useInvalidatedEvent&&this.sendEvent(new v.InvalidatedEvent(["variables"])),this.sendResponse(t)):super.customRequest(e,t,r)}convertToRuntime(e){if(e=e.trim(),e==="true")return!0;if(e==="false")return!1;if(e[0]==="'"||e[0]==='"')return e.substr(1,e.length-2);let t=parseFloat(e);return isNaN(t)?e:t}convertFromRuntime(e){let t={name:e.name,value:"???",type:typeof e.value,variablesReference:0,evaluateName:e.name};if(Array.isArray(e.value))t.value="Object",e.reference??(e.reference=this._variableHandles.create(e)),t.variablesReference=e.reference;else switch(typeof e.value){case"number":Math.round(e.value)===e.value?(t.value=this.formatNumber(e.value),t.__vscodeVariableMenuContext="simple",t.type="integer"):(t.value=e.value.toString(),t.type="float");break;case"string":t.value=`"${e.value}"`;break;case"boolean":t.value=e.value?"true":"false";break;default:t.value=typeof e.value;break}return e.memory&&(e.reference??(e.reference=this._variableHandles.create(e)),t.memoryReference=String(e.reference)),t}formatAddress(e,t=8){return this._addressesInHex?"0x"+e.toString(16).padStart(8,"0"):e.toString(10)}formatNumber(e){return this._valuesInHex?"0x"+e.toString(16):e.toString(10)}createSource(e){return new v.Source((0,Tn.basename)(e),this.convertDebuggerPathToClient(e),void 0,void 0,"8086-adapter-data")}},Ee=se;Ee.threadID=1;var y=ce(require("vscode"));function at(s,e){s.subscriptions.push(y.commands.registerCommand("extension.8086-assembly-debugger.runEditorContents",r=>{let i=r;!i&&y.window.activeTextEditor&&(i=y.window.activeTextEditor.document.uri),i&&y.debug.startDebugging(void 0,{type:"8086",name:"Run File",request:"launch",program:i.fsPath},{noDebug:!0})}),y.commands.registerCommand("extension.8086-assembly-debugger.debugEditorContents",r=>{let i=r;!i&&y.window.activeTextEditor&&(i=y.window.activeTextEditor.document.uri),i&&y.debug.startDebugging(void 0,{type:"8086",name:"Debug File",request:"launch",program:i.fsPath,stopOnEntry:!0})}),y.commands.registerCommand("extension.8086-assembly-debugger.toggleFormatting",r=>{let i=y.debug.activeDebugSession;i&&i.customRequest("toggleFormatting")})),s.subscriptions.push(y.commands.registerCommand("extension.8086-assembly-debugger.getProgramName",r=>y.window.showInputBox({placeHolder:"Please enter the name of an assembly file in the workspace folder",value:"test.asm"})));let t=new On;s.subscriptions.push(y.debug.registerDebugConfigurationProvider("8086",t)),s.subscriptions.push(y.debug.registerDebugConfigurationProvider("8086",{provideDebugConfigurations(r){return[{name:"Dynamic Launch",request:"launch",type:"8086",program:"${file}"},{name:"Another Dynamic Launch",request:"launch",type:"8086",program:"${file}"},{name:"8086 Launch",request:"launch",type:"8086",program:"${file}"}]}},y.DebugConfigurationProviderTriggerKind.Dynamic)),e||(e=new Fn),s.subscriptions.push(y.debug.registerDebugAdapterDescriptorFactory("8086",e)),"dispose"in e&&s.subscriptions.push(e)}var On=class{resolveDebugConfiguration(e,t,r){if(!t.type&&!t.request&&!t.name){let i=y.window.activeTextEditor;i&&i.document.languageId==="plaintext"&&(t.type="8086",t.name="Launch",t.request="launch",t.program="${file}",t.stopOnEntry=!0)}return t.program?t:y.window.showInformationMessage("Cannot find a program to debug").then(i=>{})}},Gt={isWindows:!1,async readFile(s){let e;try{e=_n(s)}catch{return new TextEncoder().encode(`cannot read '${s}'`)}return await y.workspace.fs.readFile(e)},async writeFile(s,e){await y.workspace.fs.writeFile(_n(s),e)}};function _n(s){try{return y.Uri.file(s)}catch{return y.Uri.parse(s)}}var Fn=class{createDebugAdapterDescriptor(e){return new y.DebugAdapterInlineImplementation(new Ee(Gt))}};var Ai="inline";function wi(s){switch(Ai){case"server":at(s,new Gn);break;case"namedPipeServer":at(s,new Vn);break;case"external":default:at(s,new Wn);break;case"inline":at(s);break}}function xi(){}var Wn=class{createDebugAdapterDescriptor(e,t){if(!t){let r="absolute path to my DA executable",i=["some args","another arg"],o={cwd:"working directory for executable",env:{envVariable:"some value"}};t=new Fe.DebugAdapterExecutable(r,i,o)}return t}},Gn=class{createDebugAdapterDescriptor(e,t){return this.server||(this.server=Is.createServer(r=>{let i=new Ee(Gt);i.setRunAsServer(!0),i.start(r,r)}).listen(0)),new Fe.DebugAdapterServer(this.server.address().port)}dispose(){this.server&&this.server.close()}},Vn=class{createDebugAdapterDescriptor(e,t){if(!this.server){let r=(0,Un.randomBytes)(10).toString("utf8"),i=zn.platform==="win32"?(0,Es.join)("\\\\.\\pipe\\",r):(0,Es.join)((0,Mn.tmpdir)(),r);this.server=Is.createServer(o=>{let a=new Ee(Gt);a.setRunAsServer(!0),a.start(o,o)}).listen(i)}return new Fe.DebugAdapterNamedPipeServer(this.server.address())}dispose(){this.server&&this.server.close()}};"use strict";0&&(module.exports={activate,deactivate});
